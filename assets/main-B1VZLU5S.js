import{_ as Z,i as un}from"./index-aai2l_1a.js";const fn=!0,D={DRAG:"#FF6B6B",PLACEMENT:"#4ECDC4",SCORE:"#FFE66D",PERF:"#95E1D3",GRID:"#A8D8EA",ERROR:"#FF4444",SUCCESS:"#66BB6A",INFO:"#90CAF9"};function Ye(t,e){return`%c${t}`}function _(t,e,n,o=null){const i=`[${new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}] ${t}`,s=`color: ${n}; font-weight: bold; font-size: 12px;`;o?console.log(Ye(i),s,e,o):console.log(Ye(i),s,e)}function mn(t,e,n,o){_("DRAG START",`Piece #${t} from (${e}, ${n})`,D.DRAG,{gridPosition:o})}function gn(t,e,n,o,a){_("DRAG MOVE",`${a?"âœ“ VALID":"âœ— INVALID"} - Piece #${t} â†’ Cell (${o.row}, ${o.col})`,a?D.SUCCESS:"#FF9800",{pos:`${e},${n}`})}function pn(t,e,n,o){_("PLACEMENT âœ“",`Valid placement - Piece #${t} fills ${o} cells`,D.SUCCESS,{position:`(${e}, ${n})`})}function hn(t,e){_("LINE CLEAR",`${t.length} line(s) cleared! ${e} cells freed`,D.SUCCESS,{lines:t.join(", ")})}function Ve(t,e){_("SCORE +",`+${t} points (${e})`,D.SCORE,{totalAfter:"see game state"})}function Xe(t,e){_("GAME OVER",`Final Score: ${t} (${e} pieces used)`,"#FF4444",{finalScore:t,piecesUsed:e})}function pt(t){performance.mark(`${t}-start`)}function Ae(t){try{performance.mark(`${t}-end`),performance.measure(t,`${t}-start`,`${t}-end`);const n=performance.getEntriesByName(t)[0].duration.toFixed(2),o=n>16?"#FF6B6B":D.PERF;_("PERF",`${t}: ${n}ms`,o),performance.clearMarks(`${t}-start`),performance.clearMarks(`${t}-end`),performance.clearMeasures(t)}catch(e){console.warn("Performance measurement failed:",e)}}function yn(t,e=null){_("WARNING",t,"#FFA500",e)}function Sn(t){console.group("%cðŸ“Š GAME STATE SNAPSHOT",`color: ${D.INFO}; font-weight: bold;`),console.log("Score:",t.score),console.log("High Score:",t.highScore),console.log("Game Over:",t.isGameOver),console.log("Paused:",t.isPaused),console.log("Combo Multiplier:",t.currentComboMultiplier),console.log("Grid Empty Cells:",t.gridEmptyCellCount),console.log("Dragging:",t.dragState.isDragging),console.groupEnd()}let xe=!1;function vn(){xe||(xe=!0,console.log("%c"+"=".repeat(80),`color: ${D.SUCCESS}; font-size: 11px;`),console.log("%cðŸŽ® BLOKUS GAME STARTED",`color: ${D.SUCCESS}; font-size: 16px; font-weight: bold;`),console.log("%cLogger enabled - monitoring all game events",`color: ${D.INFO};`))}function Cn(){xe=!1}function En(t){_("GAME MODE",`Mode: ${t}`,D.INFO)}const h=10,p=10,Ln=400,je=[{shape:[[0,0]],color:1,size:1,name:"1x1"},{shape:[[0,0],[0,1]],color:2,size:2,name:"1x2"},{shape:[[0,0],[1,0]],color:2,size:2,name:"2x1"},{shape:[[0,0],[0,1],[0,2]],color:3,size:3,name:"1x3"},{shape:[[0,0],[1,0],[2,0]],color:3,size:3,name:"3x1"},{shape:[[0,0],[0,1],[0,2],[0,3]],color:4,size:4,name:"1x4"},{shape:[[0,0],[1,0],[2,0],[3,0]],color:4,size:4,name:"4x1"},{shape:[[0,0],[0,1],[0,2],[0,3],[0,4]],color:5,size:5,name:"1x5"},{shape:[[0,0],[1,0],[2,0],[3,0],[4,0]],color:5,size:5,name:"5x1"},{shape:[[0,0],[0,1],[1,0],[1,1]],color:6,size:4,name:"2x2"},{shape:[[0,0],[0,1],[0,2],[1,0],[1,1],[1,2],[2,0],[2,1],[2,2]],color:7,size:9,name:"3x3"},{shape:[[0,0],[1,0],[2,0],[2,1]],color:1,size:4,name:"L4_1"},{shape:[[0,0],[1,0],[0,1],[0,2]],color:1,size:4,name:"L4_2"},{shape:[[0,1],[1,0],[1,1],[1,2]],color:2,size:4,name:"T4"},{shape:[[0,0],[0,1],[1,1],[1,2]],color:3,size:4,name:"Z4"},{shape:[[0,1],[1,0],[1,1],[2,0]],color:3,size:4,name:"Z4_vert"}];function _e(t=h,e=p){return Array.from({length:t},()=>Array(e).fill(0))}function ht(){return{isDragging:!1,pieceIndex:-1,pieceSourceElement:null,offsetX:0,offsetY:0,touchIdentifier:null,touchOffsetY:0,lastTargetRow:void 0,lastTargetCol:void 0,blockSize:30,gap:0,paddingX:0,paddingY:0,metricsCached:!1,cloneWidth:80,cloneHeight:80,startX:0,startY:0,startTime:0,hasMoved:!1,gridMetricsCached:!1,gridRect:{left:0,top:0},cellSize:0,step:0,gridPadL:0,gridPadT:0,gridBordL:0,gridBordT:0}}const r={grid:[],score:0,highScore:0,isGameOver:!1,isPaused:!1,currentPieces:[],combo:{count:0,timeoutId:null},dragState:ht(),rotateTokens:0,undoTokens:0,clearLineTokens:0,flipTokens:0,swapTokens:0,lastPlacementCells:[],gameHistory:[],specialModes:{rotateMode:!1,undoMode:!1,clearLineMode:!1,flipMode:!1,isWaitingForRotate:!1,isWaitingForFlip:!1}};function Mn(t,e){const n=t.length,o=t[0].length,a=n*o,i=Math.floor(a*e);let s=0;for(;s<i;){const c=Math.floor(Math.random()*n),d=Math.floor(Math.random()*o);t[c][d]===0&&(t[c][d]=Math.ceil(Math.random()*7),s++)}}function yt(){r.combo.timeoutId&&clearTimeout(r.combo.timeoutId),r.combo.count=0,r.combo.timeoutId=null}function ne(){r.dragState=ht()}function St(t){r.score=t}function vt(t){r.highScore=t}function Ct(){const t=localStorage.getItem("blokusHighScore")?parseInt(localStorage.getItem("blokusHighScore")):0;r.grid=_e(),St(0),vt(t),r.isGameOver=!1,r.isPaused=!1,r.currentPieces=[],yt(),ne(),r.gameHistory=[],r.specialModes={rotateMode:!1,undoMode:!1,clearLineMode:!1,flipMode:!1,isWaitingForRotate:!1,isWaitingForFlip:!1},(localStorage.getItem("selectedGameMode")||"collection")==="classic"&&Mn(r.grid,.2),r.rotateTokens=1,r.undoTokens=1,r.clearLineTokens=1,r.flipTokens=1,r.swapTokens=0,r.lastPlacementCells=[]}const bn=Object.freeze(Object.defineProperty({__proto__:null,createEmptyGrid:_e,gameState:r,initializeState:Ct,resetCombo:yt,resetDragState:ne,setHighScore:vt,setScore:St},Symbol.toStringTag,{value:"Module"}));class kn{constructor(){this.userPlayStyle=this.loadUserPlayStyle(),this.gameAnalytics=this.loadGameAnalytics(),this.learningData=this.loadLearningData()}generateSmartHints(e,n){const o=this.analyzeGameContext(n),a=this.analyzeUserPreferences(),i=this.identifyStrategicSituations(n),s=[...this.analyzeLineCompletionPotential(e,n),...this.analyzeFutureSpaceOptimization(e,n),...this.analyzeComboSetupOpportunities(e,n),...this.analyzeDefensivePositioning(e,n),...this.analyzeRiskMitigation(e,n)],c=this.applyAIWeights(s,o,a),d=this.applyMLOptimization(c,i);return this.selectBestHints(d,3)}analyzeGameContext(e){const n=this.calculateOccupancy(e),o=this.calculateFragmentation(e),a=this.calculateRiskLevel(e),i=this.calculateOpportunityScore(e);return{gamePhase:this.determineGamePhase(n),urgencyLevel:this.calculateUrgencyLevel(a,n),spaceEfficiency:this.calculateSpaceEfficiency(e),strategicPriority:this.determineStrategicPriority(o,i)}}analyzeUserPreferences(){const e=this.userPlayStyle.recentMoves||[];return{preferredStrategy:this.identifyPreferredStrategy(e),riskTolerance:this.calculateRiskTolerance(e),planningHorizon:this.calculatePlanningHorizon(e),efficiencyFocus:this.calculateEfficiencyFocus(e)}}analyzeLineCompletionPotential(e,n){const o=[],a=e.currentShape||e.shape;for(let i=0;i<h;i++)for(let s=0;s<p;s++)if(this.isValidPlacement(a,i,s,n)){const c=this.analyzeLinePotential(a,i,s,n);c.score>.6&&o.push({row:i,col:s,type:"line_completion",score:c.score,confidence:c.confidence,reasoning:c.reasoning,futureOpportunities:c.futureOpportunities})}return o}analyzeFutureSpaceOptimization(e,n){const o=[],a=e.currentShape||e.shape;for(let i=0;i<h;i++)for(let s=0;s<p;s++)if(this.isValidPlacement(a,i,s,n)){const c=this.simulatePlacement(a,i,s,n),d=this.calculateSpaceOptimization(c),l=this.calculateFlexibilityScore(c);d.score>.7&&o.push({row:i,col:s,type:"space_optimization",score:d.score,confidence:l,reasoning:`Optimizes future space usage: ${d.benefits}`,futureFlexibility:l})}return o}analyzeComboSetupOpportunities(e,n){const o=[],a=e.currentShape||e.shape;for(let i=0;i<h;i++)for(let s=0;s<p;s++)if(this.isValidPlacement(a,i,s,n)){const c=this.predictComboOpportunities(a,i,s,n);c.potentialCombos>1&&o.push({row:i,col:s,type:"combo_setup",score:c.totalScore,confidence:c.confidence,reasoning:`Sets up ${c.potentialCombos}-line combo`,comboDetails:c.details})}return o}analyzeDefensivePositioning(e,n){const o=[],a=e.currentShape||e.shape,i=this.identifyRiskAreas(n);for(let s=0;s<h;s++)for(let c=0;c<p;c++)if(this.isValidPlacement(a,s,c,n)){const d=this.calculateDefenseScore(a,s,c,n,i);d.score>.6&&o.push({row:s,col:c,type:"defensive",score:d.score,confidence:d.reliability,reasoning:d.explanation,riskMitigation:d.mitigatedRisks})}return o}analyzeRiskMitigation(e,n){const o=[];this.identifyCriticalAreas(n);const a=e.currentShape||e.shape;for(let i=0;i<h;i++)for(let s=0;s<p;s++)if(this.isValidPlacement(a,i,s,n)){const c=this.analyzeGameOverRisk(a,i,s,n);c.riskReduction>.5&&o.push({row:i,col:s,type:"risk_mitigation",score:c.score,confidence:c.confidence,reasoning:`Reduces game over risk by ${Math.round(c.riskReduction*100)}%`,riskFactors:c.factors})}return o}applyAIWeights(e,n,o){return e.map(a=>{let i=a.score;switch(n.gamePhase){case"early":a.type==="space_optimization"&&(i*=1.3);break;case"middle":a.type==="combo_setup"&&(i*=1.2);break;case"late":a.type==="risk_mitigation"&&(i*=1.5);break}return o.preferredStrategy==="aggressive"&&a.type==="combo_setup"&&(i*=1.2),o.riskTolerance==="low"&&a.type==="defensive"&&(i*=1.3),{...a,adjustedScore:i}})}applyMLOptimization(e,n){const o=this.calculateNeuralWeights(n);return e.map(a=>{const i=this.extractHintFeatures(a),s=this.calculateMLScore(i,o);return{...a,mlScore:s,finalScore:a.adjustedScore*.7+s*.3}})}selectBestHints(e,n=3){return e.sort((a,i)=>i.finalScore-a.finalScore),this.ensureHintDiversity(e.slice(0,n*2)).slice(0,n)}ensureHintDiversity(e){const n=new Set,o=[];for(const i of e)(!n.has(i.type)||o.length<2)&&(o.push(i),n.add(i.type));const a=e.filter(i=>!o.includes(i));return o.push(...a.slice(0,3-o.length)),o}recordUserDecision(e,n,o){this.learningData.decisions.push({timestamp:Date.now(),hints:e,chosen:n,outcome:o,gameContext:this.analyzeGameContext(r.grid)}),this.updateUserPlayStyle(n,o),this.saveLearningData()}calculateOccupancy(e){let n=0;for(let o=0;o<h;o++)for(let a=0;a<p;a++)e[o][a]!==0&&n++;return n/(h*p)}calculateFragmentation(e){let n=0;for(let o=0;o<h;o++)for(let a=0;a<p;a++)e[o][a]===0&&[[o-1,a],[o+1,a],[o,a-1],[o,a+1]].filter(([c,d])=>c>=0&&c<h&&d>=0&&d<p&&e[c][d]===0).length<2&&n++;return Math.min(n/(h*p),1)}calculateRiskLevel(e){const n=this.calculateOccupancy(e),o=this.calculateFragmentation(e);return Math.min(n*.7+o*.3,1)}calculateOpportunityScore(e){let n=0;for(let o=0;o<h;o++){const a=e[o].filter(i=>i===0).length;a<=2&&a>0&&n++}for(let o=0;o<p;o++){let a=0;for(let i=0;i<h;i++)e[i][o]===0&&a++;a<=2&&a>0&&n++}return Math.min(n/10,1)}determineGamePhase(e){return e<.3?"early":e<.7?"middle":"late"}calculateUrgencyLevel(e,n){return Math.min(e+n*.3,1)}calculateSpaceEfficiency(e){const n=this.calculateOccupancy(e),o=this.calculateFragmentation(e);return Math.max(0,n-o*.5)}determineStrategicPriority(e,n){return e>.6?"cleanup":n>.5?"completion":"expansion"}identifyPreferredStrategy(e){return e.length===0?"balanced":e.length>50?"aggressive":"defensive"}calculateRiskTolerance(e){return"medium"}calculatePlanningHorizon(e){return e.length>30?"long-term":"short-term"}calculateEfficiencyFocus(e){return .7}analyzeLinePotential(e,n,o,a){let i=0,s=.5,c="",d=0;const l=this.simulatePlacement(e,n,o,a),u=this.countCompletedLines(l)-this.countCompletedLines(a);if(u>0)i=.8+u*.1,s=.9,c=`Completes ${u} line(s)`,d=u*2;else{const m=this.countAlmostCompleteLines(l);m>0&&(i=.6,s=.7,c=`Sets up ${m} line(s) for completion`,d=m)}return{score:i,confidence:s,reasoning:c,futureOpportunities:d}}calculateSpaceOptimization(e){const n=this.calculateSpaceEfficiency(e),o=n>.7?"high space efficiency":"moderate space usage";return{score:n,benefits:o}}calculateFlexibilityScore(e){const n=this.calculateFragmentation(e);return Math.max(0,1-n)}simulatePlacement(e,n,o,a){const i=a.map(s=>[...s]);return e.forEach(([s,c])=>{const d=n+s,l=o+c;d>=0&&d<h&&l>=0&&l<p&&(i[d][l]=1)}),i}countCompletedLines(e){let n=0;for(let o=0;o<h;o++)e[o].every(a=>a!==0)&&n++;for(let o=0;o<p;o++){let a=!0;for(let i=0;i<h;i++)if(e[i][o]===0){a=!1;break}a&&n++}return n}countAlmostCompleteLines(e){let n=0;for(let o=0;o<h;o++){const a=e[o].filter(i=>i===0).length;a<=2&&a>0&&n++}for(let o=0;o<p;o++){let a=0;for(let i=0;i<h;i++)e[i][o]===0&&a++;a<=2&&a>0&&n++}return n}predictComboOpportunities(e,n,o,a){const i=this.simulatePlacement(e,n,o,a),s=this.countCompletedLines(a),d=this.countCompletedLines(i)-s;return{potentialCombos:d,totalScore:d*.8,confidence:d>0?.8:.3,details:`${d} potential combo lines`}}identifyRiskAreas(e){const n=[];for(let o=0;o<h;o++)for(let a=0;a<p;a++)if(e[o][a]===0){const i=this.countSurroundingOccupied(e,o,a);i>=3&&n.push({row:o,col:a,risk:i/4})}return n}countSurroundingOccupied(e,n,o){return[[n-1,o],[n+1,o],[n,o-1],[n,o+1]].filter(([i,s])=>i>=0&&i<h&&s>=0&&s<p&&e[i][s]!==0).length}calculateDefenseScore(e,n,o,a,i){let s=.5,c=.6,d="Standard placement",l=0;return e.forEach(([u,m])=>{const g=n+u,S=o+m,E=i.find(y=>y.row===g&&y.col===S);E&&(s+=E.risk*.2,l++)}),l>0&&(d=`Fills ${l} risky gap(s)`,c=.8),{score:s,reliability:c,explanation:d,mitigatedRisks:l}}identifyCriticalAreas(e){const n=[];if(this.calculateOccupancy(e)>.7)for(let a=0;a<h;a++)for(let i=0;i<p;i++)e[a][i]===0&&n.push({row:a,col:i});return n}analyzeGameOverRisk(e,n,o,a){const i=this.calculateRiskLevel(a),s=this.simulatePlacement(e,n,o,a),c=this.calculateRiskLevel(s),d=Math.max(0,i-c);return{score:.5+d*.5,confidence:d>.1?.8:.4,riskReduction:d,factors:["space optimization","fragmentation reduction"]}}calculateNeuralWeights(e){return{lineCompletion:.8,spaceOptimization:.6,comboSetup:.7,defensive:.5,riskMitigation:.9}}extractHintFeatures(e){return{score:e.score||0,confidence:e.confidence||.5,type:e.type||"unknown",position:[e.row||0,e.col||0]}}calculateMLScore(e,n){const o=n[e.type]||.5;return e.score*.4+e.confidence*.3+o*.3}ensureHintDiversity(e){const n=new Set,o=[];for(const i of e)(!n.has(i.type)||o.length<2)&&(o.push(i),n.add(i.type));const a=e.filter(i=>!o.includes(i));return o.push(...a.slice(0,3-o.length)),o}recordUserDecision(e,n,o){this.learningData.decisions||(this.learningData.decisions=[]),this.learningData.decisions.push({timestamp:Date.now(),hints:e,chosen:n,outcome:o,gameContext:this.analyzeGameContext(r.grid)}),this.updateUserPlayStyle(n,o),this.saveLearningData()}updateUserPlayStyle(e,n){this.userPlayStyle.preferences||(this.userPlayStyle.preferences={});const o=(e==null?void 0:e.type)||"unknown";this.userPlayStyle.preferences[o]||(this.userPlayStyle.preferences[o]={count:0,success:0}),this.userPlayStyle.preferences[o].count++,n==="success"&&this.userPlayStyle.preferences[o].success++}analyzeRecentPerformance(){const e=this.gameAnalytics.recentMoves||[];return e.length===0?{averageSuccess:.5}:{averageSuccess:e.filter(o=>o.success).length/e.length}}calculateGameDuration(){return r.startTime?Date.now()-r.startTime:0}identifyStrategicSituations(e){return{occupancy:this.calculateOccupancy(e),fragmentation:this.calculateFragmentation(e),opportunities:this.calculateOpportunityScore(e)}}isValidPlacement(e,n,o,a){for(const[i,s]of e){const c=n+i,d=o+s;if(c<0||c>=h||d<0||d>=p||a[c][d]!==0)return!1}return!0}loadUserPlayStyle(){return JSON.parse(localStorage.getItem("aiHints_userStyle")||"{}")}loadGameAnalytics(){return JSON.parse(localStorage.getItem("aiHints_analytics")||'{"recentMoves": [], "performance": []}')}loadLearningData(){return JSON.parse(localStorage.getItem("aiHints_learningData")||'{"decisions": [], "patterns": {}}')}saveLearningData(){localStorage.setItem("aiHints_learningData",JSON.stringify(this.learningData)),localStorage.setItem("aiHints_userStyle",JSON.stringify(this.userPlayStyle)),localStorage.setItem("aiHints_analytics",JSON.stringify(this.gameAnalytics))}}new kn;class Pn{constructor(){this.unlockedPieces=this.loadUnlockedPieces(),this.lastScore=0}checkForUnlocks(e){const n=[],o=this.getUnlockTiers();for(const a of o)e>=a.requiredScore&&!this.unlockedPieces.includes(a.id)&&(this.unlockedPieces.push(a.id),n.push(a));return n.length>0&&(this.saveUnlockedPieces(),this.showUnlockNotification(n)),n}getAvailablePieces(){return this.getAllPieceDefinitions().filter(n=>n.tier==="starter"||this.unlockedPieces.includes(n.id))}getUnlockTiers(){return[{id:"bronze1",requiredScore:1e3,name:"P-Shape",tier:"bronze"},{id:"bronze2",requiredScore:1e3,name:"U-Shape",tier:"bronze"},{id:"bronze3",requiredScore:1e3,name:"Y-Shape",tier:"bronze"},{id:"bronze4",requiredScore:1e3,name:"F-Shape",tier:"bronze"},{id:"bronze5",requiredScore:1e3,name:"N-Shape",tier:"bronze"},{id:"silver1",requiredScore:3e3,name:"V-Shape",tier:"silver"},{id:"silver2",requiredScore:3e3,name:"W-Shape",tier:"silver"},{id:"silver3",requiredScore:3e3,name:"Cross",tier:"silver"},{id:"silver4",requiredScore:3e3,name:"Plus",tier:"silver"},{id:"silver5",requiredScore:3e3,name:"Corner",tier:"silver"},{id:"silver6",requiredScore:3e3,name:"Step",tier:"silver"},{id:"gold1",requiredScore:7e3,name:"Spiral",tier:"gold"},{id:"gold2",requiredScore:7e3,name:"Diamond",tier:"gold"},{id:"gold3",requiredScore:7e3,name:"Arrow",tier:"gold"},{id:"gold4",requiredScore:7e3,name:"Bridge",tier:"gold"},{id:"gold5",requiredScore:7e3,name:"Claw",tier:"gold"},{id:"gold6",requiredScore:7e3,name:"Wave",tier:"gold"},{id:"platinum1",requiredScore:15e3,name:"Master-1",tier:"platinum"},{id:"platinum2",requiredScore:15e3,name:"Master-2",tier:"platinum"},{id:"platinum3",requiredScore:15e3,name:"Master-3",tier:"platinum"},{id:"platinum4",requiredScore:15e3,name:"Master-4",tier:"platinum"},{id:"platinum5",requiredScore:15e3,name:"Master-5",tier:"platinum"},{id:"platinum6",requiredScore:15e3,name:"Master-6",tier:"platinum"}]}getUnlockMilestones(){return[{id:"bronze",requiredScore:1e3,name:"Bronze Tier",tierName:"bronze"},{id:"silver",requiredScore:3e3,name:"Silver Tier",tierName:"silver"},{id:"gold",requiredScore:7e3,name:"Gold Tier",tierName:"gold"},{id:"platinum",requiredScore:15e3,name:"Platinum Tier",tierName:"platinum"}]}getAllPieceDefinitions(){return[{id:"I",name:"I-Line",shape:[[0,0],[0,1],[0,2],[0,3]],color:1,tier:"starter"},{id:"O",name:"O-Square",shape:[[0,0],[0,1],[1,0],[1,1]],color:2,tier:"starter"},{id:"T",name:"T-Shape",shape:[[0,1],[1,0],[1,1],[1,2]],color:3,tier:"starter"},{id:"S",name:"S-Shape",shape:[[0,1],[0,2],[1,0],[1,1]],color:4,tier:"starter"},{id:"Z",name:"Z-Shape",shape:[[0,0],[0,1],[1,1],[1,2]],color:5,tier:"starter"},{id:"J",name:"J-Shape",shape:[[0,0],[1,0],[1,1],[1,2]],color:6,tier:"starter"},{id:"L",name:"L-Shape",shape:[[0,2],[1,0],[1,1],[1,2]],color:7,tier:"starter"},{id:"bronze1",name:"P-Shape",shape:[[0,0],[0,1],[1,0],[1,1],[2,0]],color:1,tier:"bronze"},{id:"bronze2",name:"U-Shape",shape:[[0,0],[0,2],[1,0],[1,1],[1,2]],color:2,tier:"bronze"},{id:"bronze3",name:"Y-Shape",shape:[[0,1],[1,0],[1,1],[2,1],[3,1]],color:3,tier:"bronze"},{id:"bronze4",name:"F-Shape",shape:[[0,1],[0,2],[1,0],[1,1],[2,1]],color:4,tier:"bronze"},{id:"bronze5",name:"N-Shape",shape:[[0,1],[1,0],[1,1],[2,0],[3,0]],color:5,tier:"bronze"},{id:"silver1",name:"V-Shape",shape:[[0,0],[1,0],[2,0],[2,1],[2,2]],color:6,tier:"silver"},{id:"silver2",name:"W-Shape",shape:[[0,0],[1,0],[1,1],[2,1],[2,2]],color:7,tier:"silver"},{id:"silver3",name:"Cross",shape:[[0,1],[1,0],[1,1],[1,2],[2,1]],color:1,tier:"silver"},{id:"silver4",name:"Plus",shape:[[0,1],[1,0],[1,1],[1,2],[2,1]],color:2,tier:"silver"},{id:"silver5",name:"Corner",shape:[[0,0],[0,1],[0,2],[1,0],[2,0]],color:3,tier:"silver"},{id:"silver6",name:"Step",shape:[[0,0],[1,0],[1,1],[2,1],[2,2]],color:4,tier:"silver"},{id:"gold1",name:"Spiral",shape:[[0,0],[0,1],[1,1],[1,2],[2,0],[2,2]],color:5,tier:"gold"},{id:"gold2",name:"Diamond",shape:[[0,1],[1,0],[1,1],[1,2],[2,1]],color:6,tier:"gold"},{id:"gold3",name:"Arrow",shape:[[0,1],[1,0],[1,1],[1,2],[2,1],[3,1]],color:7,tier:"gold"},{id:"gold4",name:"Bridge",shape:[[0,0],[0,1],[0,2],[1,0],[1,2]],color:1,tier:"gold"},{id:"gold5",name:"Claw",shape:[[0,0],[0,2],[1,0],[1,1],[1,2]],color:2,tier:"gold"},{id:"gold6",name:"Wave",shape:[[0,0],[0,1],[1,1],[1,2],[2,2],[2,3]],color:3,tier:"gold"},{id:"platinum1",name:"Master-1",shape:[[0,0],[0,1],[0,2],[1,1],[2,0],[2,2]],color:4,tier:"platinum"},{id:"platinum2",name:"Master-2",shape:[[0,1],[1,0],[1,1],[1,2],[2,0],[2,2]],color:5,tier:"platinum"},{id:"platinum3",name:"Master-3",shape:[[0,0],[0,2],[1,0],[1,1],[1,2],[2,1]],color:6,tier:"platinum"},{id:"platinum4",name:"Master-4",shape:[[0,0],[0,1],[1,1],[1,2],[2,1],[3,1]],color:7,tier:"platinum"},{id:"platinum5",name:"Master-5",shape:[[0,1],[1,0],[1,1],[2,1],[2,2],[3,1]],color:1,tier:"platinum"},{id:"platinum6",name:"Master-6",shape:[[0,0],[0,1],[0,2],[1,0],[1,2],[2,1]],color:2,tier:"platinum"}]}showUnlockNotification(e){const n={bronze:"BRONZE TIER",silver:"SILVER TIER",gold:"GOLD TIER",platinum:"PLATINUM TIER"},o={bronze:"ðŸ¥‰",silver:"ðŸ¥ˆ",gold:"ðŸ¥‡",platinum:"ðŸ’Ž"},a={};e.forEach(i=>{a[i.tier]||(a[i.tier]=[]),a[i.tier].push(i)}),Object.keys(a).forEach(i=>{const s=a[i],c=`${o[i]} ${n[i]} UNLOCKED!
${s.length} new pieces available: ${s.map(d=>d.name).join(", ")}`;this.displayUnlockNotification(c,i)})}displayUnlockNotification(e,n){const o=document.createElement("div");o.className=`unlock-notification unlock-${n}`,o.innerHTML=`
            <div class="unlock-content">
                <h3>ðŸŽ‰ NEW PIECES UNLOCKED!</h3>
                <p>${e}</p>
            </div>
        `,document.body.appendChild(o),setTimeout(()=>o.classList.add("show"),100),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>document.body.removeChild(o),500)},4e3),this.playUnlockSound()}playUnlockSound(){try{const e=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGeSYELYTO8teMOAcabLvs5Z0TAA4A");e.volume=.3,e.play()}catch{}}getNextUnlock(){const e=(r==null?void 0:r.score)||0,n=this.getUnlockMilestones();for(const o of n)if(e<o.requiredScore)return{name:o.name,requiredScore:o.requiredScore,remaining:Math.max(0,o.requiredScore-e)};return null}loadUnlockedPieces(){try{return JSON.parse(localStorage.getItem("blocustema_unlockedPieces")||"[]")}catch{return[]}}saveUnlockedPieces(){localStorage.setItem("blocustema_unlockedPieces",JSON.stringify(this.unlockedPieces))}getProgressInfo(){const o=this.getAvailablePieces().length,a=o/30*100,i=this.getNextUnlock();return{totalPieces:30,unlockedCount:o,percentage:Math.round(a),nextUnlock:i}}resetUnlocks(){this.unlockedPieces=[],this.saveUnlockedPieces()}}const K=new Pn,Et=new Map,$=new Map;function wn(t,e=!0){if(typeof t!="number")return!1;if(e){if(t<0||t>=h)return!1;for(let n=0;n<p;n++)r.grid[t][n]=0}else{if(t<0||t>=p)return!1;for(let n=0;n<h;n++)r.grid[n][t]=0}return $.clear(),r.lastPlacementCells=[],!0}function Tn(t,e=1){if(t<0||t>=p)return!1;const n=e>=0?1:-1,o=[];for(let a=0;a<h;a++)o.push(r.grid[a][t]);if(n===1){const a=o.shift();o.push(a??0)}else{const a=o.pop();o.unshift(a??0)}for(let a=0;a<h;a++)r.grid[a][t]=o[a];return $.clear(),r.lastPlacementCells=[],!0}function An(){Et.clear(),$.clear()}function xn(){Et.clear()}function me(t,e){return t>=0&&t<h&&e>=0&&e<p}function Ne(){const t=K.getAvailablePieces();if(t.length===0){let a={...je[Math.floor(Math.random()*je.length)],id:Date.now()+Math.random()};a.currentShape=a.shape,a.size=a.shape.length;for(let i=0,s=Math.floor(Math.random()*4);i<s;i++)a=re(a);return a}const e=Math.floor(Math.random()*t.length),n=t[e];let o={...n,id:Date.now()+Math.random(),currentShape:n.shape,size:n.shape.length};for(let a=0,i=Math.floor(Math.random()*4);a<i;a++)o=re(o);return o}function Lt(){r.currentPieces=[];for(let t=0;t<3;t++)r.currentPieces.push(Ne())}function Mt(t){r.currentPieces[t]=Ne()}function re(t){if(!t||!t.currentShape)return t;let e=1/0,n=-1/0,o=1/0;t.currentShape.forEach(([l,u])=>{e=Math.min(e,l),n=Math.max(n,l),o=Math.min(o,u)});const a=n-e,i=t.currentShape.map(([l,u])=>[u-o,a-(l-e)]);let s=1/0,c=1/0;i.forEach(([l,u])=>{s=Math.min(s,l),c=Math.min(c,u)});const d=i.map(([l,u])=>[l-s,u-c]);return{...t,currentShape:d}}function bt(t){if(!t||!t.currentShape)return t;let e=1/0,n=-1/0;t.currentShape.forEach(([d,l])=>{e=Math.min(e,l),n=Math.max(n,l)});const o=n-e,a=t.currentShape.map(([d,l])=>[d,o-(l-e)]);let i=1/0,s=1/0;a.forEach(([d,l])=>{i=Math.min(i,d),s=Math.min(s,l)});const c=a.map(([d,l])=>[d-i,l-s]);return{...t,currentShape:c}}function H(t,e,n){for(const[o,a]of t){const i=e+o,s=n+a;if(!me(i,s)||r.grid[i][s]!==0)return!1}return!0}function kt(t,e,n){t.currentShape.forEach(([o,a])=>{r.grid[e+o][n+a]=t.color}),r.score+=t.size,$.clear()}function Pt(t=null){const e=[],n=[];for(let l=0;l<h;l++)r.grid[l].every(u=>u!==0)&&e.push(l);for(let l=0;l<p;l++){let u=!0;for(let m=0;m<h;m++)if(r.grid[m][l]===0){u=!1;break}u&&n.push(l)}const o=e.length+n.length;if(o===0)return r.combo.count=0,null;const a=t?se(t):"rgba(133, 76, 19, 1)",i=new Set;e.forEach(l=>{for(let u=0;u<p;u++)i.add(JSON.stringify({row:l,col:u}))}),n.forEach(l=>{for(let u=0;u<h;u++)i.add(JSON.stringify({row:u,col:l}))});const s=Array.from(i).map(l=>({...JSON.parse(l),animationColor:a}));r.combo.count++;const c=Bn(o,r.combo.count);r.score+=c;const d={cellsToAnimate:s,pointsEarned:c,comboCount:r.combo.count,totalLinesCleared:o,clearedRows:e,clearedCols:n,placedPieceColor:t};return $.clear(),d}function Bn(t,e){let n=0;t===1?n=100:t===2?n=250:t===3?n=500:t===4?n=800:t>=5&&(n=1e3+(t-4)*200);let o=e>1?(e-1)*50:0;return e>=5&&(o+=500+(e-5)*100),n+o}function Be(){const t=r.currentPieces.filter(e=>e);if(t.length===0){r.isGameOver=!1;return}for(const e of t){if(Je(e.currentShape)){r.isGameOver=!1;return}if(r.rotateTokens>0){let n=e.currentShape;for(let o=1;o<4;o++)if(n=re({...e,currentShape:n}).currentShape,Je(n)){r.isGameOver=!1;return}}}r.isGameOver=!0}function $e(){const t={grid:r.grid.map(e=>[...e]),score:r.score,currentPieces:r.currentPieces.map(e=>e?{...e,currentShape:Array.isArray(e.currentShape)?[...e.currentShape]:e.currentShape}:null),combo:{...r.combo},rotateTokens:r.rotateTokens,undoTokens:r.undoTokens,clearLineTokens:r.clearLineTokens,swapTokens:r.swapTokens,timestamp:Date.now()};r.gameHistory.push(t),r.gameHistory.length>10&&r.gameHistory.shift()}function wt(){if(r.gameHistory.length===0)return!1;const t=r.gameHistory.pop();return r.grid=t.grid,r.score=t.score,r.currentPieces=t.currentPieces,r.combo=t.combo,r.rotateTokens=t.rotateTokens,r.undoTokens=t.undoTokens,r.clearLineTokens=t.clearLineTokens,r.swapTokens=t.swapTokens,!0}function In(t,e){return e?r.grid[t].every(n=>n!==0):r.grid.every(n=>n[t]!==0)}function Rn(t,e){const n=[];if(e)for(let o=0;o<p;o++)n.push({row:t,col:o});else for(let o=0;o<h;o++)n.push({row:o,col:t});return n}function Tt(t){return r.rotateTokens<=0||!r.currentPieces[t]?!1:(r.currentPieces[t]=re(r.currentPieces[t]),r.currentPieces[t].id=Date.now()+Math.random(),!0)}function Je(t){for(let e=0;e<h;e++)for(let n=0;n<p;n++)if(H(t,e,n))return!0;return!1}function se(t){switch(t){case 1:return"#0072ff";case 2:return"#56ab2f";case 3:return"#6b4f2a";case 4:return"#fc4a1a";case 5:return"#333399";case 6:return"#fecfef";case 7:return"#fed6e3";default:return"#FFD700"}}function At(t){const e=[],n=t.currentShape||t.shape;for(let o=0;o<h;o++)for(let a=0;a<p;a++)H(n,o,a)&&e.push({row:o,col:a});return e}function Dn(t){const e=JSON.stringify(t.currentShape||t.shape),n=On(),o=`${e}-${n}`;if($.has(o))return $.get(o);const a=At(t),i=t.currentShape||t.shape;if(a.length===0)return $.set(o,[]),[];const s=a.map(d=>{const{row:l,col:u}=d,m=Fn(i,l,u);return{...d,score:m}});s.sort((d,l)=>l.score-d.score);const c=s.slice(0,Math.min(8,Math.max(3,Math.ceil(s.length*.2))));return $.set(o,c),c}function On(){let t=0;for(let e=0;e<h;e++)for(let n=0;n<p;n++)t=(t<<5)-t+r.grid[e][n]>>>0;return t.toString(16)}function Fn(t,e,n){let o=0;(e===0||e===h-1)&&(n===0||n===p-1)&&(o+=50),(e===0||e===h-1||n===0||n===p-1)&&(o+=30);const s=Gn(t,e,n);o+=s*20;const c=zn(t,e,n);return o+=c*15,e>2&&e<h-3&&n>2&&n<p-3&&(o-=20),o}function Gn(t,e,n){let o=0;const a=new Set,i=new Set;return t.forEach(([s,c])=>{const d=e+s,l=n+c;me(d,l)&&(a.add(d),i.add(l))}),a.forEach(s=>{let c=0;for(let l=0;l<p;l++)r.grid[s][l]!==0&&c++;const d=c/p;d>.6&&(o+=d*2)}),i.forEach(s=>{let c=0;for(let l=0;l<h;l++)r.grid[l][s]!==0&&c++;const d=c/h;d>.6&&(o+=d*2)}),o}function zn(t,e,n){let o=0;return t.forEach(([a,i])=>{const s=e+a,c=n+i;me(s,c)&&[[-1,0],[1,0],[0,-1],[0,1]].forEach(([l,u])=>{const m=s+l,g=c+u;me(m,g)&&r.grid[m][g]!==0&&o++})}),o}const _n=Object.freeze(Object.defineProperty({__proto__:null,checkAndClearLines:Pt,clearAllCaches:An,clearDOMCache:xn,clearRowOrColumn:wn,createEmptyGrid:_e,findBestPlacements:Dn,findValidPlacements:At,flipPieceHorizontally:bt,getBaseColor:se,getLineCells:Rn,getRandomPiece:Ne,isLineComplete:In,isValidPlacement:H,placePieceOnGrid:kt,populateInitialPieces:Lt,replaceUsedPiece:Mt,rotatePiece:re,rotateSpecificPiece:Tt,saveGameState:$e,shiftColumn:Tn,undoLastMove:wt,updateGameOverState:Be},Symbol.toStringTag,{value:"Module"}));let C,Ie=!1;function G(){if(!Ie)try{C=new(window.AudioContext||window.webkitAudioContext),Ie=!0}catch{}}function z(t,e,n,o="sine",{allowWhenInactive:a=!1}={}){if(!Ie||!C||!(localStorage.getItem("soundEnabled")!=="false")||(r.isPaused||r.isGameOver)&&!a)return;const s=C.createOscillator(),c=C.createGain();s.connect(c),c.connect(C.destination),s.type=o,s.frequency.setValueAtTime(t,C.currentTime),c.gain.setValueAtTime(n,C.currentTime),c.gain.exponentialRampToValueAtTime(.001,C.currentTime+e),s.start(C.currentTime),s.stop(C.currentTime+e)}function O(t=50){localStorage.getItem("vibrationEnabled")!=="false"&&window.navigator&&window.navigator.vibrate&&window.navigator.vibrate(t)}const Nn=()=>{z(440,.1,.3,"square"),O(30)},xt=t=>{z(600+t*50,.15,.4,"triangle"),O([50,30,50])},Ze=()=>{G(),C&&(z(200,.5,.5,"sawtooth",{allowWhenInactive:!0}),setTimeout(()=>z(150,.5,.5,"sawtooth",{allowWhenInactive:!0}),200))},Ke=()=>{z(1200,.05,.1,"sine"),O(20)},$n=()=>{G(),C&&C.state==="suspended"&&C.resume(),z(400,.05,.3,"square",{allowWhenInactive:!0}),O(20)},qn=()=>{G(),C&&C.state==="suspended"&&C.resume(),z(250,.1,.3,"triangle",{allowWhenInactive:!0}),O(30)},Hn=()=>{G(),C&&C.state==="suspended"&&C.resume(),z(550,.1,.3,"triangle",{allowWhenInactive:!0}),O(30)},Wn=()=>{G(),C&&C.state==="suspended"&&C.resume(),z(700,.1,.3,"sawtooth",{allowWhenInactive:!0}),O(40)},Qe=()=>{G(),C&&C.state==="suspended"&&C.resume(),z(660,.08,.15,"sine"),O(15)};class Un{constructor(e=100){this.pool=Array.from({length:e},()=>({r:0,c:0,delay:0})),this.index=0}acquire(){const e=this.pool[this.index];return this.index=(this.index+1)%this.pool.length,e}}const Yn=new Un,f={};let q=[],Re=new Set,De="";const et=950;function Bt(){["landingPage","startButton","gameGrid","piecesContainer","score","highscore-display","restartButton","pauseButton","settingsButton","gameOverMessage","gameOverRestartButton","darkModeToggleGame","particles-overlay","comboMessage","themeSelectorContainer","draggedPieceClone","pieces-unlocked","achievements-count","finalScore","gameOverHighScore"].forEach(e=>f[e]=document.getElementById(e)),f.gameContainer=document.querySelector(".game-container")}function tt(){const t=document.getElementById("unlock-progress");t&&t.remove();const e=document.createElement("div");e.id="unlock-progress",e.className="unlock-progress",e.innerHTML=`
        <h4>ðŸ”“ Piece Collection</h4>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">7/30 pieces unlocked</div>
        <div class="progress-text" id="next-unlock-text">Next unlock: 1000 points</div>
    `,document.body.appendChild(e),f.unlockProgress=e;const n=i=>{e.contains(i.target)||o()},o=()=>{e.parentNode&&e.remove(),document.removeEventListener("click",n),a&&clearTimeout(a)};e.addEventListener("click",o);const a=setTimeout(()=>{o()},3e3);document.addEventListener("click",n),Zn()}function It(){f.gameGrid.innerHTML="",q=[];for(let t=0;t<h;t++){const e=[];for(let n=0;n<p;n++){const o=document.createElement("div");o.classList.add("grid-cell"),o.dataset.row=t,o.dataset.col=n;const a=document.createElement("div");a.classList.add("grid-cell-block"),o.appendChild(a),f.gameGrid.appendChild(o),e.push(o)}q.push(e)}}function Rt(t,e){const n=document.createElement("div");if(n.classList.add("piece"),n.dataset.pieceIndex=e,!t)return n.classList.add("empty"),n.dataset.pieceId="",n;n.dataset.pieceId=t.id?t.id.toString():"",n.setAttribute("draggable","true");const o=Dt(t);return n.appendChild(o),n}function Dt(t){const e=document.createElement("div");e.classList.add("piece-grid");let n=0,o=0;t.currentShape.forEach(([i,s])=>{n=Math.max(n,i),o=Math.max(o,s)}),e.style.gridTemplateRows=`repeat(${n+1}, var(--piece-block-size))`,e.style.gridTemplateColumns=`repeat(${o+1}, var(--piece-block-size))`;const a=Array.from({length:n+1},()=>Array(o+1).fill(0));t.currentShape.forEach(([i,s])=>{a[i][s]=t.color});for(let i=0;i<=n;i++)for(let s=0;s<=o;s++){const c=document.createElement("div");c.classList.add("piece-block"),a[i][s]!==0?(c.classList.add(`color-${a[i][s]}`),c.dataset.shapeRow=i,c.dataset.shapeCol=s):c.style.visibility="hidden",e.appendChild(c)}return e}function Vn(t,e){const n=!e,o=!t||t.classList.contains("empty");if(n||o)return n!==o;const a=t.dataset.pieceId||"",i=e.id?e.id.toString():"";return a!==i}function Ot(t,e,{isInitialLoad:n=!1,allowSound:o=!0}={}){if(!(!t||t.classList.contains("empty"))){if(t.classList.add("new-piece"),n){const a=e*150;t.style.animationDelay=`${a}ms`,o&&setTimeout(()=>Qe(),a),setTimeout(()=>{t.classList.remove("new-piece"),t.style.animationDelay=""},et+a);return}o&&Qe(),setTimeout(()=>{t.classList.remove("new-piece")},et)}}function Xn({animateAll:t=!1}={}){f.piecesContainer&&(f.piecesContainer.innerHTML="",r.currentPieces.forEach((e,n)=>{const o=Rt(e,n);f.piecesContainer.appendChild(o),t&&Ot(o,n,{isInitialLoad:!0,allowSound:!0})}))}function U(){const t=[];for(let e=0;e<h;e++)for(let n=0;n<p;n++){const o=r.grid[e][n],a=q[e][n];let i=a.firstChild,s=!i;t.push({cellElement:a,blockWrapper:i,needsCreation:s,cellValue:o,newClass:o!==0?`filled-${o}`:null})}t.forEach(({cellElement:e,blockWrapper:n,needsCreation:o,cellValue:a,newClass:i})=>{o&&(n=document.createElement("div"),n.classList.add("grid-cell-block"),e.appendChild(n)),n.className="grid-cell-block",i&&n.classList.add(i)})}function jn(){r.lastPlacementCells=[]}function Jn(t){if(!Array.isArray(t)||t.length===0)return;let e=0,n=0;t.forEach(({r:a,c:i})=>{e+=a,n+=i}),e/=t.length,n/=t.length;const o=t.map(({r:a,c:i})=>{const s=Yn.acquire(),c=Math.hypot(a-4,i-4);return s.r=a,s.c=i,s.delay=c*30,s});t.forEach(({r:a,c:i})=>{var d;const s=(d=q[a])==null?void 0:d[i];if(!s)return;const c=s.querySelector(".grid-cell-block");c&&(c.classList.remove("placed"),c.style.animation="none",c.offsetWidth)}),o.forEach(({r:a,c:i,delay:s})=>{var m;const c=(m=q[a])==null?void 0:m[i];if(!c)return;const d=c.querySelector(".grid-cell-block");if(!d)return;const l=(Math.random()-.5)*14,u=Math.max(0,s+l);d.style.animation="",d.style.animationDelay=`${u}ms`,d.classList.add("placed"),d.addEventListener("animationend",()=>{d.classList.remove("placed"),d.style.animationDelay=""},{once:!0})})}function te(t=!1){if(!f.piecesContainer||!Array.isArray(r.currentPieces))return;const e=Array.from(f.piecesContainer.children),n=r.currentPieces;if(t||e.length!==n.length){Xn({animateAll:t});return}const o=[];for(let i=0;i<n.length;i++)Vn(e[i],n[i])&&o.push(i);if(o.length===0)return;let a=!1;o.forEach(i=>{const s=n[i],c=Rt(s,i),d=e[i];if(d&&d.parentNode===f.piecesContainer?d.replaceWith(c):f.piecesContainer.children[i]?f.piecesContainer.replaceChild(c,f.piecesContainer.children[i]):f.piecesContainer.appendChild(c),s){const l=!a;Ot(c,i,{allowSound:l,isInitialLoad:!1}),l&&(a=!0)}})}function Se(){f.score.textContent=r.score;const t=f.score;t&&(t.classList.remove("score-animated"),t.offsetWidth,t.classList.add("score-animated")),r.score>r.highScore&&(r.highScore=r.score,localStorage.setItem("blokusHighScore",r.highScore)),f["highscore-display"]&&(f["highscore-display"].textContent=r.highScore)}function Zn(){if((localStorage.getItem("selectedGameMode")||"collection")!=="collection")return;const e=K.getProgressInfo(),n=document.getElementById("progress-fill"),o=document.getElementById("progress-text"),a=document.getElementById("next-unlock-text");n&&(n.style.width=`${e.percentage}%`),o&&(o.textContent=`${e.unlockedCount}/${e.totalPieces} pieces unlocked`),a&&e.nextUnlock?a.textContent=`Next: ${e.nextUnlock.name} (${e.nextUnlock.remaining} points)`:a&&(a.textContent="ðŸŽ‰ All pieces unlocked!")}function ge(){try{const t=r.isGameOver;f.gameOverMessage&&(f.gameOverMessage.classList.toggle("hidden",!t),t&&setTimeout(()=>{const e=document.getElementById("gameOverRestartButton");if(e){e.onclick=null;const n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),Z(async()=>{const{initializeState:a}=await Promise.resolve().then(()=>bn);return{initializeState:a}},void 0).then(({initializeState:a})=>{Z(()=>Promise.resolve().then(()=>_n),void 0).then(i=>{f.gameOverMessage.classList.add("hidden"),a(),i.populateInitialPieces(),U(),te(),Se(),ge(),setTimeout(()=>{window.attachPieceEventListeners?window.attachPieceEventListeners():Z(()=>Promise.resolve().then(()=>Fo),void 0).then(s=>{s.attachPieceEventListeners&&s.attachPieceEventListeners()})},200)}).catch(i=>console.log("Error loading gameLogic:",i))}).catch(a=>console.log("Error loading state:",a))})}},100)),t?(f.piecesContainer&&(f.piecesContainer.style.opacity="0.5"),f.gameGrid&&(f.gameGrid.style.opacity="0.5")):(f.piecesContainer&&(f.piecesContainer.style.opacity="1"),f.gameGrid&&(f.gameGrid.style.opacity="1"))}catch{}}function ve(){f.pauseButton&&(f.pauseButton.disabled=r.isGameOver,f.pauseButton.innerHTML=r.isPaused?'<i class="fas fa-play"></i>':'<i class="fas fa-pause"></i>',f.pauseButton.title=r.isPaused?"Resume Game":"Pause Game",f.pauseButton.setAttribute("aria-label",r.isPaused?"Resume Game":"Pause Game")),f.restartButton&&(f.restartButton.disabled=r.isGameOver,r.isPaused?f.restartButton.classList.remove("hidden"):f.restartButton.classList.add("hidden"))}function Kn(t){const e=f.comboMessage;e.textContent=t>=5?`SPEKTAKOLARE! COMBO x${t}`:`Combo x${t}`,e.classList.remove("hidden"),t>=5&&e.classList.add("spectacular"),setTimeout(()=>{e.classList.add("hidden"),e.classList.remove("spectacular")},1200)}function nt(){const t=document.querySelectorAll(".floating-score"),e=Date.now(),n=5e3;t.forEach(o=>{const a=parseInt(o.dataset.created);a&&e-a>n&&o.remove()})}function Ft(t){if(!f.draggedPieceClone){console.warn("draggedPieceClone element not found in DOM");return}const e=Dt(t);f.draggedPieceClone.innerHTML="",f.draggedPieceClone.setAttribute("data-clone","true"),e.querySelectorAll(".piece-block").forEach(l=>l.classList.add("clone-block")),f.draggedPieceClone.appendChild(e),f.draggedPieceClone.classList.remove("hidden","shake"),f.draggedPieceClone.classList.add("show");let n=30;const o=f.draggedPieceClone.querySelector(".piece-block");o&&(n=o.getBoundingClientRect().width);let a=0;const i=f.draggedPieceClone.querySelector(".piece-grid");if(i){const l=getComputedStyle(i),u=l.gap||l.gridGap,m=parseFloat(u);Number.isNaN(m)||(a=m)}const s=getComputedStyle(f.draggedPieceClone),c=parseFloat(s.paddingLeft)||0,d=parseFloat(s.paddingTop)||0;Object.assign(r.dragState,{blockSize:n,gap:a,paddingX:c,paddingY:d,metricsCached:!0})}function Qn(){f.draggedPieceClone.classList.remove("show")}function eo(t){f.draggedPieceClone.classList.add("shake"),setTimeout(()=>{f.draggedPieceClone.classList.remove("shake")},t)}function Y(t,e){if(!f.draggedPieceClone||!f.draggedPieceClone.classList.contains("show"))return;f.draggedPieceClone.style.transform="none";const{offsetX:n,offsetY:o}=r.dragState;let{blockSize:a,gap:i,paddingX:s,paddingY:c,metricsCached:d,cloneWidth:l,cloneHeight:u}=r.dragState;if(!d){let y=a;const x=f.draggedPieceClone.querySelector(".piece-block");x&&(y=x.getBoundingClientRect().width);let k=i;const P=f.draggedPieceClone.querySelector(".piece-grid");if(P){const R=getComputedStyle(P),X=R.gap||R.gridGap,v=parseFloat(X);Number.isNaN(v)||(k=v)}const M=getComputedStyle(f.draggedPieceClone),L=parseFloat(M.paddingLeft)||0,V=parseFloat(M.paddingTop)||0,B=f.draggedPieceClone.offsetWidth||80,ae=f.draggedPieceClone.offsetHeight||80;Object.assign(r.dragState,{blockSize:y||30,gap:Number.isNaN(k)?0:k,paddingX:L,paddingY:V,metricsCached:!0,cloneWidth:B,cloneHeight:ae}),{blockSize:a,gap:i,paddingX:s,paddingY:c,cloneWidth:l,cloneHeight:u}=r.dragState}(!a||a<=0)&&(a=30),Number.isFinite(i)||(i=0),Number.isFinite(s)||(s=0),Number.isFinite(c)||(c=0);const m=s+n*(a+i)+a/2,g=c+o*(a+i)+a/2,S=t-m,E=e-g;f.draggedPieceClone.style.setProperty("transform",`translate3d(${S}px, ${E}px, 0)`,"important"),f.draggedPieceClone.style.left="0",f.draggedPieceClone.style.top="0"}function oe(){Re.forEach(t=>{t.classList.remove("highlight","invalid-highlight");const e=t.querySelector(".grid-cell-block");e&&(e.classList.remove("ghost"),De&&e.classList.remove(`filled-${De}`)),t.style.backgroundColor=""}),Re.clear()}function qe(t,e,n,o){oe();const a=o?"highlight":"invalid-highlight";De=t.color,t.currentShape.forEach(([i,s])=>{const c=e+i,d=n+s;if(c>=0&&c<h&&d>=0&&d<p){const l=q[c][d];if(!l)return;const u=l.querySelector(".grid-cell-block");if(!u)return;Array.from(u.classList).some(g=>g.startsWith("filled-"))||(l.classList.add(a),o&&u.classList.add("ghost",`filled-${t.color}`),Re.add(l))}})}function to(){ce();for(let t=0;t<h;t++)if(r.grid[t].every(e=>e!==0))for(let e=0;e<p;e++)q[t][e].classList.add("clearable-line");for(let t=0;t<p;t++){let e=!0;for(let n=0;n<h;n++)if(r.grid[n][t]===0){e=!1;break}if(e)for(let n=0;n<h;n++)q[n][t].classList.add("clearable-line")}}function ce(){document.querySelectorAll(".grid-cell.clearable-line").forEach(t=>{t.classList.remove("clearable-line")})}function Oe(){if(!f["particles-overlay"])return;const e=f["particles-overlay"].querySelectorAll(".particle"),n=Date.now(),o=5e3;e.forEach(a=>{const i=parseInt(a.dataset.created);if(i&&n-i>o){const s=a.dataset.timeoutId;s&&clearTimeout(parseInt(s)),a.remove()}})}setInterval(Oe,1e4);let Ce=!1;document.addEventListener("perf:lite",()=>{Ce=!0});function no(){const t=document.getElementById("magicStars");if(!t)return;t.innerHTML="";const e=["rgba(255, 200, 255, 0.9)","rgba(200, 220, 255, 0.9)","rgba(255, 220, 200, 0.9)"];for(let n=0;n<(Ce?8:25);n++){const o=document.createElement("div");o.className="magic-star",o.style.left=`${Math.random()*100}%`,o.style.top=`${Math.random()*100}%`;const a=Math.random()*5+3;o.style.width=`${a}px`,o.style.height=`${a}px`,o.style.background=e[Math.floor(Math.random()*e.length)],o.style.animationDelay=`${Math.random()*5}s`,t.appendChild(o)}}function oo(){const t=document.getElementById("specialShapes");if(t){t.innerHTML="";for(let e=0;e<(Ce?4:10);e++){const n=document.createElement("div");n.className=Math.random()>.5?"star-shape":"heart-shape",n.style.left=`${Math.random()*100}%`,n.style.top=`${Math.random()*100}%`;const o=`hsl(${Math.random()*60+300}, 80%, 80%)`;n.style.background=o,n.style.animationDelay=`${Math.random()*10}s`,n.style.animationDuration=`${Math.random()*10+10}s`,t.appendChild(n)}}}function ao(){const t=document.getElementById("sparkles");if(t){t.innerHTML="";for(let e=0;e<(Ce?10:30);e++){const n=document.createElement("div");n.className="sparkle",n.style.left=`${Math.random()*100}%`,n.style.top=`${Math.random()*100}%`,n.style.animationDelay=`${Math.random()*30}s`,n.style.animationDuration=`${Math.random()*30+45}s`;const o=Math.random()*4+2;n.style.width=`${o}px`,n.style.height=`${o}px`,t.appendChild(n)}}}function io(){const t=document.querySelector(".magic-universe-background");t&&(t.style.display="block"),no(),oo(),ao()}function Gt(){const t=document.querySelector(".magic-universe-background");t&&t.classList.add("paused")}function zt(){const t=document.querySelector(".magic-universe-background");t&&t.classList.remove("paused")}document.addEventListener("visibilitychange",()=>{document.hidden?Gt():zt()});document.addEventListener("app:pause",Gt);document.addEventListener("app:resume",zt);async function ro(t){var e,n;try{const o=(n=(e=window.Capacitor)==null?void 0:e.Plugins)==null?void 0:n.StatusBar;if(!o)return;t==="dark"?(await o.setStyle({style:"DARK"}),await o.setBackgroundColor({color:"#0b0f1a"})):(await o.setStyle({style:"LIGHT"}),await o.setBackgroundColor({color:"#f2f5ff"}))}catch{}}let so=new URLSearchParams(location.search).get("debug")==="1",W=null;function co(){if(!so||W)return;W=document.createElement("div"),W.id="fpsOverlay",W.textContent="FPS: --",document.body.appendChild(W);let t=0,e=performance.now();const n=o=>{t++,o-e>=1e3&&(W&&(W.textContent="FPS: "+t),t=0,e=o),requestAnimationFrame(n)};requestAnimationFrame(n)}const _t=!!(window.Capacitor&&window.Capacitor.isNativePlatform);function Nt(){_t&&document.body.classList.add("capacitor-native")}function $t(){var e,n;const t=(n=(e=window.Capacitor)==null?void 0:e.Plugins)==null?void 0:n.App;if(t)try{t.addListener("appStateChange",({isActive:o})=>{const a=new CustomEvent(o?"app:resume":"app:pause");document.dispatchEvent(a)})}catch{}}async function lo(){var t,e;try{const n=(e=(t=window.Capacitor)==null?void 0:t.Plugins)==null?void 0:e.Haptics;n!=null&&n.impact&&await n.impact({style:"light"})}catch{}}async function uo(){var t,e;try{const n=(e=(t=window.Capacitor)==null?void 0:t.Plugins)==null?void 0:e.Haptics;n!=null&&n.notification?await n.notification({type:"SUCCESS"}):n!=null&&n.impact&&await n.impact({style:"Medium"})}catch{}}async function fo(){var t,e;try{const n=(e=(t=window.Capacitor)==null?void 0:t.Plugins)==null?void 0:e.Haptics;n!=null&&n.impact&&await n.impact({style:"Heavy"})}catch{}}const He=Object.freeze(Object.defineProperty({__proto__:null,attachAppLifecycle:$t,hapticHeavy:fo,hapticSuccess:uo,hapticTap:lo,isNative:_t,readyNativeUI:Nt},Symbol.toStringTag,{value:"Module"})),qt=80,Ht=1e3;function Wt(t,e){const n=document.body.getAttribute("data-theme")==="dark";if(typeof t=="number"&&t>=1&&t<=7||typeof t=="string"&&t){let o=typeof t=="number"?se(t):t;if(n){const a=Yt(o);let i=0;a<100?i=40:a<180?i=25:a<220&&(i=10),i>0&&(o=Fe(o,i))}return o}return e}function Ut(t,e,n,o=null){const a=document.body.getAttribute("data-theme")==="dark";if(o&&o>=1&&o<=7){let l=se(o);if(a){const u=Yt(l);let m=0;u<100?m=40:u<180?m=25:u<220&&(m=10),m>0&&(l=Fe(l,m))}return{colors:[l,l,l,"#22d3ee"],dominantColor:l}}const i={},s=[];t.forEach((l,u)=>{if((n?Math.floor(u/p):u%p)===e){const g=l.querySelector(".grid-cell-block");if(!g)return;const S=Array.from(g.classList).find(E=>E.startsWith("filled-"));if(S){const E=parseInt(S.replace("filled-",""));let y=se(E);a&&(y=Fe(y,20)),s.push(y),i[y]=(i[y]||0)+1}}});let c="#60a5fa",d=0;for(const[l,u]of Object.entries(i))u>d&&(d=u,c=l);if(s.push("#22d3ee"),s.length===1){const l=a?["#60a5fa","#22d3ee","#a78bfa"]:["#3b82f6","#06b6d4","#8b5cf6"];return{colors:l,dominantColor:l[0]}}return{colors:s,dominantColor:c}}function Fe(t,e){const n=parseInt(t.replace("#",""),16),o=Math.min(255,(n>>16&255)+Math.round(255*(e/100))),a=Math.min(255,(n>>8&255)+Math.round(255*(e/100))),i=Math.min(255,(n&255)+Math.round(255*(e/100)));return`#${(o<<16|a<<8|i).toString(16).padStart(6,"0")}`}function Yt(t){const e=parseInt(t.replace("#",""),16),n=e>>16&255,o=e>>8&255,a=e&255;return n*.299+o*.587+a*.114}function Vt(t){var o;const e=(o=getComputedStyle(document.documentElement).getPropertyValue("--grid-cell-radius"))==null?void 0:o.trim(),n=e&&e.length?e:"8px";if(!t)return n;try{const a=t.querySelector(".grid-cell");if(a){const i=window.getComputedStyle(a).borderRadius;if(i&&i.trim().length)return i}}catch(a){console.warn("[galaxyRowClear] Failed to read grid cell border radius",a)}return n}function Xt(t=380){try{const e=document.querySelector(".game-area .game-grid")||document.querySelector(".game-area .game-grid-container")||document.querySelector(".game-area");if(!e)return;const n="ext-game-area-shake",o="ext-game-area-shake-strong",a=e.getAttribute("data-ext-shake-strong")==="1";try{}catch{}const i=a?o:n;e.classList.add(i);const s=c=>{try{if(c&&c.target!==e)return}catch{}try{e.classList.remove(i),e.removeEventListener("animationend",s);try{e.removeAttribute("data-ext-shake-strong")}catch{}}catch{}};e.addEventListener("animationend",s,{once:!0})}catch(e){console.warn("triggerGameAreaShake error",e)}}function mo(t,e,n,o,a=null){if(!e||t<0||t>=h){o&&o();return}const i=e.querySelectorAll(".grid-cell");po(t,e,n,a);const s=[];i.forEach((c,d)=>{if(Math.floor(d/p)===t){const u=c.querySelector(".grid-cell-block");if(!u)return;Array.from(u.classList).some(g=>g.startsWith("filled-"))&&(u.classList.remove("ext-galaxy-block-collapse"),u.offsetWidth,u.classList.add("ext-galaxy-block-collapse"),s.push(u))}});try{const c=s.length,d=380,l=c>=6,u=document.querySelector(".game-area .game-grid")||document.querySelector(".game-area .game-grid-container")||document.querySelector(".game-area");u&&u.setAttribute("data-ext-shake-strong",l?"1":"0"),Xt(d)}catch(c){console.warn("shake trigger failed",c)}setTimeout(()=>{o&&o()},qt),setTimeout(()=>{i.forEach((c,d)=>{if(Math.floor(d/p)===t){const u=c.querySelector(".grid-cell-block");if(!u)return;u.classList.remove("ext-galaxy-block-collapse"),Array.from(u.classList).forEach(m=>{m.startsWith("filled-")&&u.classList.remove(m)})}})},Ht)}function go(t,e,n,o,a=null){if(!e||t<0||t>=p){o&&o();return}const i=e.querySelectorAll(".grid-cell");ho(t,e,n,a);const s=[];i.forEach((c,d)=>{if(d%p===t){const u=c.querySelector(".grid-cell-block");if(!u)return;Array.from(u.classList).some(g=>g.startsWith("filled-"))&&(u.classList.remove("ext-galaxy-block-collapse"),u.offsetWidth,u.classList.add("ext-galaxy-block-collapse"),s.push(u))}});try{const c=s.length,d=380,l=c>=6,u=document.querySelector(".game-area .game-grid")||document.querySelector(".game-area .game-grid-container")||document.querySelector(".game-area");u&&u.setAttribute("data-ext-shake-strong",l?"1":"0"),Xt(d)}catch(c){console.warn("shake trigger failed",c)}setTimeout(()=>{o&&o()},qt),setTimeout(()=>{i.forEach((c,d)=>{if(d%p===t){const u=c.querySelector(".grid-cell-block");if(!u)return;u.classList.remove("ext-galaxy-block-collapse"),Array.from(u.classList).forEach(m=>{m.startsWith("filled-")&&u.classList.remove(m)})}})},Ht)}function po(t,e,n,o=null){if(!n||!e)return;e.getBoundingClientRect();const a=n.getBoundingClientRect(),i=getComputedStyle(e);parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--grid-cell-size"));const s=parseFloat(i.gap)||0;parseFloat(i.paddingLeft),parseFloat(i.paddingTop),parseFloat(i.borderLeftWidth),parseFloat(i.borderTopWidth);const c=e.querySelectorAll(".grid-cell");if(c.length===0)return;const l=c[0].getBoundingClientRect();let u=t*p;if(c.length>u){const S=c[u].getBoundingClientRect().top-a.top,E=l.left-a.left,y=l.width*p+s*(p-1),x=Vt(e),k=document.createElement("div");k.className="ext-galaxy-clear-bar-container",k.style.position="absolute",k.style.top=S+"px",k.style.left=E+"px",k.style.width=y+"px",k.style.height=l.height+"px",k.style.borderRadius=x;const P=document.createElement("div");P.className="ext-galaxy-clear-bar-inner",P.style.borderRadius=x;let M=30;const L=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),V=(navigator.hardwareConcurrency||4)<=4;L&&(M=V?15:22);const{colors:B,dominantColor:ae}=Ut(c,t,!0,o),R=Wt(o,ae);P.style.border=`2px solid ${R}`,P.style.background=`radial-gradient(ellipse at center, ${R}15, transparent)`,P.style.boxShadow=`
            inset 0 0 40px ${R}80,
            inset 0 0 30px ${R}70,
            inset 0 0 20px ${R}60,
            inset 0 0 10px ${R}40
        `;for(let X=0;X<M;X++){const v=document.createElement("div");v.className="ext-galaxy-particle";const le=L?4+Math.random()*6:8+Math.random()*12,b=Math.round(le),de=B[Math.floor(Math.random()*B.length)],j=Math.random()*100,ue=(L?700:900)+Math.random()*(L?400:600),be=Math.random()*150,ke=(Math.random()-.5)*(L?12:20),Pe=(Math.random()-.5)*(L?6:10),we=(Math.random()>.5?1:-1)*((L?30:50)+Math.random()*(L?40:80)),Te=(Math.random()-.5)*(L?18:30);v.style.width=b+"px",v.style.height=b+"px",v.style.backgroundColor=de,v.style.color=de,v.style.left=j+"%",v.style.top="50%",v.style.marginTop=-b/2+"px",v.style.borderRadius=Math.max(2,Math.round(b*.25))+"px",v.style.animationDuration=ue+"ms",v.style.animationDelay=be+"ms",v.style.setProperty("--ext-dx-start",ke+"px"),v.style.setProperty("--ext-dy-start",Pe+"px"),v.style.setProperty("--ext-dx-end",we+"px"),v.style.setProperty("--ext-dy-end",Te+"px"),P.appendChild(v)}k.appendChild(P),n.appendChild(k),setTimeout(()=>{k.parentNode&&k.remove()},1500)}}function ho(t,e,n,o=null){if(!n||!e)return;const a=n.getBoundingClientRect(),i=getComputedStyle(e),s=e.querySelectorAll(".grid-cell");if(s.length===0)return;const d=s[0].getBoundingClientRect();let l=t;if(s.length>l){const m=s[l].getBoundingClientRect(),S=s[s.length-1].getBoundingClientRect(),E=parseFloat(i.gap)||0,y=S.bottom-d.top+E,x=m.left-a.left,k=d.top-a.top,P=Vt(e),M=document.createElement("div");M.className="ext-galaxy-clear-bar-container",M.style.position="absolute",M.style.left=x+"px",M.style.top=k+"px",M.style.width=d.width+"px",M.style.height=y+"px",M.style.borderRadius=P;const L=document.createElement("div");L.className="ext-galaxy-clear-bar-inner",L.style.width="100%",L.style.height="100%",L.style.borderRadius=P;let V=30;const B=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),ae=(navigator.hardwareConcurrency||4)<=4;B&&(V=ae?15:22);const{colors:R,dominantColor:X}=Ut(s,t,!1,o),v=Wt(o,X);L.style.border=`2px solid ${v}`,L.style.background=`radial-gradient(ellipse at center, ${v}15, transparent)`,L.style.boxShadow=`
            inset 0 0 40px ${v}80,
            inset 0 0 30px ${v}70,
            inset 0 0 20px ${v}60,
            inset 0 0 10px ${v}40
        `;for(let le=0;le<V;le++){const b=document.createElement("div");b.className="ext-galaxy-particle";const de=B?4+Math.random()*6:8+Math.random()*12,j=Math.round(de),ue=R[Math.floor(Math.random()*R.length)],be=Math.random()*100,ke=(B?700:900)+Math.random()*(B?400:600),Pe=Math.random()*150,Ue=(Math.random()-.5)*(B?8:10),we=(Math.random()-.5)*(B?12:20),Te=Math.random()>.5?1:-1,ln=(Math.random()-.5)*(B?18:30),dn=Te*((B?30:50)+Math.random()*(B?40:80));b.style.width=j+"px",b.style.height=j+"px",b.style.backgroundColor=ue,b.style.color=ue,b.style.left="50%",b.style.marginLeft=-j/2+"px",b.style.top=be+"%",b.style.borderRadius=Math.max(2,Math.round(j*.25))+"px",b.style.animationDuration=ke+"ms",b.style.animationDelay=Pe+"ms",b.style.setProperty("--ext-dx-start",Ue+"px"),b.style.setProperty("--ext-dy-start",we+"px"),b.style.setProperty("--ext-dx-end",ln+"px"),b.style.setProperty("--ext-dy-end",dn+"px"),L.appendChild(b)}M.appendChild(L),n.appendChild(M),setTimeout(()=>{M.parentNode&&M.remove()},1500)}}const jt=110,ot="rowClearOverlay";let T=null;function Jt(t=document.querySelector(".game-area")||document.body){return t?(T||(T=document.getElementById(ot)||document.createElement("div"),T.id=ot,T.setAttribute("aria-hidden","true")),T.parentElement!==t&&t.appendChild(T),T):null}function yo(t,e){const n=Jt(e);if(!n||!t||!e)return n;const o=e.getBoundingClientRect();return n.style.position="absolute",n.style.left=`${t.left-o.left}px`,n.style.top=`${t.top-o.top}px`,n.style.width=`${t.width}px`,n.style.height=`${t.height}px`,n}function So({ctx:t,rows:e=[],cols:n=[],boardSize:o,onClearRow:a,onClearCol:i,onDone:s,syncStart:c=!1,placedPieceColor:d=null}){const l=document.getElementById("gameGrid"),u=Mo(),m=[];if(e.forEach((g,S)=>{const E=Lo({rowIndex:g,order:c?0:S,boardSize:o,metrics:u,gameGrid:l});m.push(new Promise(y=>{setTimeout(()=>Eo({line:E,metrics:u,onLogicalClear:x=>a&&a(x),onResolved:y,placedPieceColor:d}),E.delay)}))}),n.forEach((g,S)=>{const E=vo({colIndex:g,order:c?0:e.length+S,boardSize:o,metrics:u,gameGrid:l});m.push(new Promise(y=>{setTimeout(()=>Co({line:E,metrics:u,onLogicalClear:x=>i&&i(x),onResolved:y,placedPieceColor:d}),E.delay)}))}),!m.length){s&&s();return}Promise.all(m).then(()=>{s&&s()})}function vo({colIndex:t,order:e,boardSize:n,metrics:o,gameGrid:a}){const i=[];if(o&&a){const s=Math.floor(a.children.length/n)||n;for(let c=0;c<s;c++){const d=a.children[c*n+t];if(!d||!Array.from(d.classList).some(S=>S.startsWith("filled-")))continue;const{x:u,y:m}=Zt(c,t,o),g=Kt(d);i.push({element:d,centerX:u,centerY:m,overlay:g})}}return{colIndex:t,cells:i,delay:e*jt,cleared:!1}}function Co({line:t,metrics:e,particleEngine:n,onLogicalClear:o,onResolved:a,placedPieceColor:i}){const s=document.getElementById("gameGrid"),c=document.querySelector(".game-area");go(t.colIndex,s,c,()=>{t.cleared||(o&&o(t.colIndex),t.cleared=!0),Qt(t),a()},i)}function Eo({line:t,metrics:e,particleEngine:n,onLogicalClear:o,onResolved:a,placedPieceColor:i}){const s=document.getElementById("gameGrid"),c=document.querySelector(".game-area");mo(t.rowIndex,s,c,()=>{t.cleared||(o&&o(t.rowIndex),t.cleared=!0),Qt(t),a()},i)}function Lo({rowIndex:t,order:e,boardSize:n,metrics:o,gameGrid:a}){const i=[];if(a)for(let s=0;s<n;s++){const c=a.children[t*n+s];if(!(!c||!Array.from(c.classList).some(l=>l.startsWith("filled-"))))if(o){const{x:l,y:u}=Zt(t,s,o),m=Kt(c);i.push({element:c,centerX:l,centerY:u,overlay:m})}else i.push({element:c,centerX:0,centerY:0,overlay:null})}return{rowIndex:t,cells:i,delay:e*jt,cleared:!1}}function Mo(t,e){return null}function Zt(t,e,n){const o=n.canvasWidth-n.padLeft-n.padRight,a=n.canvasHeight-n.padTop-n.padBottom,i=document.getElementById("gameGrid"),s=i?getComputedStyle(i).gridTemplateColumns.split(" ").length:10,c=i?getComputedStyle(i).gridTemplateRows.split(" ").length:10,d=s?(o-n.colGap*(s-1))/s:0,l=c?(a-n.rowGap*(c-1))/c:0,u=n.padLeft+e*(d+n.colGap)+d/2,m=n.padTop+t*(l+n.rowGap)+l/2;return{x:u,y:m}}function Kt(t){if(!t)return null;const e=(T==null?void 0:T.parentElement)||document.querySelector(".game-area")||document.body,n=document.getElementById("gameGrid"),o=(n==null?void 0:n.getBoundingClientRect())||null;yo(o,e);const a=T||Jt(e);if(!a)return null;const i=a.getBoundingClientRect();if(!i.width||!i.height)return null;const s=getComputedStyle(t),c=t.getBoundingClientRect(),d=s.getPropertyValue("--color-dark-1")||"#14b8a6",l=s.getPropertyValue("--color-dark-2")||"#0f766e",u=s.getPropertyValue("--color-core-light")||"rgba(173, 255, 219, 0.8)",m=s.getPropertyValue("--color-core-mid")||"rgba(81, 238, 176, 0.5)",g=s.getPropertyValue("--color-bevel-light")||"rgba(255,255,255,0.2)",S=s.getPropertyValue("--color-bevel-dark")||"rgba(0,0,0,0.4)",E=s.borderRadius||"25%",y=document.createElement("div");return y.className="cell-clear-overlay",y.style.left=`${c.left-i.left}px`,y.style.top=`${c.top-i.top}px`,y.style.width=`${c.width}px`,y.style.height=`${c.height}px`,y.style.borderRadius=E,y.style.setProperty("--color-dark-1",d),y.style.setProperty("--color-dark-2",l),y.style.setProperty("--color-core-light",u),y.style.setProperty("--color-core-mid",m),y.style.setProperty("--color-bevel-light",g),y.style.setProperty("--color-bevel-dark",S),y.style.setProperty("--overlay-color",d),y.style.setProperty("--row-clear-color",d),y.style.background=`linear-gradient(135deg, ${d}, ${l})`,a.appendChild(y),y}function Qt(t){!t||!t.cells||(t.cells.forEach(e=>{e&&e.element&&(e.element.style.opacity=""),e&&e.overlay&&(e.overlay.remove(),e.overlay=null)}),bo())}function bo(){if(!T||T.childElementCount>0)return;const t=T.parentElement;T.remove(),T=null,t&&t.hasChildNodes()}function ko(){const t=()=>{try{Nt()}catch{}try{$t()}catch{}try{co()}catch{}try{ro(document.body.dataset.theme||"dark")}catch{}try{un()}catch(e){console.warn("Failed to initialize settings:",e)}try{Ee()}catch{}try{Po()}catch{}};document.readyState==="complete"||document.readyState==="interactive"?setTimeout(t,0):document.addEventListener("DOMContentLoaded",t)}let at=null;function en(t){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()}let it=!1,rt=!1;function tn(){const t=document.getElementById("highscore-display");if(t){const o=localStorage.getItem("blokusHighScore")||"0";t.textContent=o}const e=document.getElementById("pieces-unlocked");if(e)try{const o=parseInt(localStorage.getItem("blokusHighScore")||"0");if(typeof K<"u"&&K.getAvailablePieces){const a=K.getAvailablePieces();e.textContent=a.length}else{let a=7;o>=2e3&&(a+=6),o>=4e3&&(a+=6),o>=6e3&&(a+=6),o>=8e3&&(a+=5),e.textContent=Math.min(a,30)}}catch{e.textContent="7"}const n=document.getElementById("achievements-count");if(n){const o=parseInt(localStorage.getItem("blokusHighScore")||"0");let a=0;o>=1e3&&a++,o>=5e3&&a++,o>=1e4&&a++,o>=2e4&&a++,o>=5e4&&a++,n.textContent=a}}function Ee(){Cn(),vn(),cn();const t=document.querySelector(".game-container");t&&t.classList.remove("paused"),Bt(),ye||(f.pauseButton&&(f.pauseButton.addEventListener("click",wo),J(f.pauseButton)),f.restartButton&&(f.restartButton.addEventListener("click",To),J(f.restartButton)),f.settingsButton&&window.showSettingsModal&&(f.settingsButton.addEventListener("click",window.showSettingsModal),J(f.settingsButton)),f.darkModeToggleGame&&J(f.darkModeToggleGame),ye=!0),It(),Ct(),En("Blokus Grid"),Lt(),pt("game-init");const e=document.getElementById("landingPage");typeof tt=="function"&&e&&e.classList.contains("hidden")&&tt(),U(),te(!0),Se(),ve(),I(),N(),Oo(),Ae("game-init")}function J(t){t&&t.addEventListener("click",function(e){this.classList.remove("neon-clicked"),this.offsetWidth,$n(),this.classList.add("neon-clicked"),setTimeout(()=>{this.classList.remove("neon-clicked")},400)})}function Po(){const t=document.getElementById("theme-toggle");t&&J(t),document.querySelectorAll(".mode-button.selectable").forEach(n=>J(n))}function wo(){if(!r.isGameOver)if(r.isPaused=!r.isPaused,ve(),r.isPaused){qn(),document.dispatchEvent(new Event("app:pause"));const t=document.querySelector(".game-container");t&&t.classList.add("paused")}else{Hn(),document.dispatchEvent(new Event("app:resume"));const t=document.querySelector(".game-container");t&&(t.classList.remove("paused"),t.offsetWidth)}}function To(){Sn(r),_("INFO","ðŸ”„ Game Restarted","#90CAF9"),Wn();const t=document.querySelector(".game-container");t&&t.classList.remove("paused"),Ee(),ve()}function nn(t){if(r.isPaused||r.isGameOver||r.dragState.isDragging)return;const e=t.target.closest(".piece");if(!e||e.classList.contains("empty"))return;const n=parseInt(e.dataset.pieceIndex);if(r.specialModes.rotateMode&&r.specialModes.isWaitingForRotate){Tt(n)&&(r.rotateTokens--,te(),Ke(),w("rotate","Piece rotated successfully!",1e3)),r.specialModes.rotateMode=!1,r.specialModes.isWaitingForRotate=!1,I(),N();return}if(r.specialModes.flipMode&&r.specialModes.isWaitingForFlip){const o=r.currentPieces[n];if(!o||!o.currentShape){w("flip","Cannot flip this piece",1500);return}const a=bt(o);if(!a||!a.currentShape){w("flip","Flip failed",1500);return}o.currentShape=a.currentShape,o.id=Date.now()+Math.random(),r.flipTokens--,te(),Ke(),w("flip","Piece flipped!",1e3),r.specialModes.flipMode=!1,r.specialModes.isWaitingForFlip=!1,I(),N();return}if(r.specialModes.clearLineMode){w("clearLine","Click on a grid cell to clear a line",1500);return}}let st=null,Q=0;function Le(t){if(!r.dragState.isDragging)return;const e=t.clientX,n=t.clientY;if(Y(e,n),!r.dragState.hasMoved){const o=e-r.dragState.startX,a=n-r.dragState.startY;(Math.abs(o)>10||Math.abs(a)>10)&&(r.dragState.hasMoved=!0)}st=t,Q||(Q=requestAnimationFrame(()=>{const o=st;Q=0,o&&Ao(o)}))}function Ao(t){if(!r.dragState.isDragging)return;const e=t.clientX,n=t.clientY;r.dragState.clientX=e,r.dragState.clientY=n;const o=We(e,n);if(!o){oe(),r.dragState.lastTargetRow=void 0,r.dragState.lastTargetCol=void 0;return}const a=o.row-r.dragState.offsetY,i=o.col-r.dragState.offsetX;if(a===r.dragState.lastTargetRow&&i===r.dragState.lastTargetCol)return;const s=r.currentPieces[r.dragState.pieceIndex],c=H(s.currentShape,a,i);(!r.dragState._lastValidState||r.dragState._lastValidState!==c)&&fn&&(gn(r.dragState.pieceIndex,e,n,{row:a,col:i},c),r.dragState._lastValidState=c),qe(s,a,i,c),r.dragState.lastTargetRow=a,r.dragState.lastTargetCol=i}function A(t){if(!r.dragState.isDragging)return;Q&&(cancelAnimationFrame(Q),Q=0),document.removeEventListener("mousemove",Le),document.removeEventListener("mouseup",A),window.removeEventListener("mouseup",A),document.removeEventListener("mouseleave",A),"onpointerup"in window&&document.removeEventListener("pointerup",A);const e=Date.now()-(r.dragState.startTime||0);if(!r.dragState.hasMoved&&e<300){F();return}const{pieceIndex:n,lastTargetRow:o,lastTargetCol:a}=r.dragState;if(o!==void 0&&a!==void 0){const i=r.currentPieces[n];H(i.currentShape,o,a)?rn(i,n,o,a):(he(),F())}else he(),F()}function on(){const t=f.gameGrid;if(!t)return;const e=t.getBoundingClientRect();let n=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--grid-cell-size"));if(!n||Number.isNaN(n)){const l=t.querySelector(".grid-cell");l?n=l.getBoundingClientRect().width:n=40}let o=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--grid-gap"));Number.isNaN(o)&&(o=0);const a=getComputedStyle(t),i=parseFloat(a.paddingLeft)||0,s=parseFloat(a.paddingTop)||0,c=parseFloat(a.borderLeftWidth)||0,d=parseFloat(a.borderTopWidth)||0;Object.assign(r.dragState,{gridMetricsCached:!0,gridRect:{left:e.left,top:e.top},cellSize:n,step:n+o,gridPadL:i,gridPadT:s,gridBordL:c,gridBordT:d})}function We(t,e){const n=f.gameGrid;if(!n)return null;let o,a,i,s,c,d,l,u;if(r.dragState.gridMetricsCached)o=r.dragState.cellSize,a=r.dragState.step,i=r.dragState.gridRect.left,s=r.dragState.gridRect.top,c=r.dragState.gridPadL,d=r.dragState.gridPadT,l=r.dragState.gridBordL,u=r.dragState.gridBordT;else{const k=n.getBoundingClientRect();if(i=k.left,s=k.top,o=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--grid-cell-size")),!o||Number.isNaN(o)){const L=n.querySelector(".grid-cell");L?o=L.getBoundingClientRect().width:o=40}let P=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--grid-gap"));Number.isNaN(P)&&(P=0),a=o+P;const M=getComputedStyle(n);c=parseFloat(M.paddingLeft)||0,d=parseFloat(M.paddingTop)||0,l=parseFloat(M.borderLeftWidth)||0,u=parseFloat(M.borderTopWidth)||0}const m=10*o+9*(a-o),g=10*o+9*(a-o);if(t<i||t>i+m||e<s||e>s+g)return null;const S=t-i-c-l,E=e-s-d-u;let y=Math.round((S-o/2)/a),x=Math.round((E-o/2)/a);return y=Math.min(Math.max(0,y),p-1),x=Math.min(Math.max(0,x),h-1),{row:x,col:y}}function fe(t){if(r.isPaused||r.isGameOver){t.preventDefault();return}if(r.specialModes.rotateMode||r.specialModes.flipMode||r.specialModes.hintMode){t.preventDefault();return}if(t.type==="mousedown"){t.preventDefault(),G(),O(30);const e=t.target.closest(".piece");if(!e||e.classList.contains("empty"))return;const n=parseInt(e.dataset.pieceIndex),o=r.currentPieces[n];mn(n,t.clientX,t.clientY,{row:0,col:0});const a=e.getBoundingClientRect(),i=t.clientX-a.left,s=t.clientY-a.top;let c={dist:1/0,row:0,col:0};e.querySelectorAll(".piece-block[data-shape-row]").forEach(d=>{const l=d.getBoundingClientRect(),u=l.left-a.left+l.width/2,m=l.top-a.top+l.height/2,g=Math.hypot(i-u,s-m);g<c.dist&&(c={dist:g,row:parseInt(d.dataset.shapeRow),col:parseInt(d.dataset.shapeCol)})}),ne(),on(),Object.assign(r.dragState,{isDragging:!0,pieceIndex:n,pieceSourceElement:e,offsetX:c.col,offsetY:c.row,startX:t.clientX,startY:t.clientY,startTime:Date.now(),hasMoved:!1,lastTargetRow:void 0,lastTargetCol:void 0}),Ft(o),Y(t.clientX,t.clientY),e.classList.add("dragging"),document.addEventListener("mousemove",Le),document.addEventListener("mouseup",A),window.addEventListener("mouseup",A),document.addEventListener("mouseleave",A),"onpointerup"in window&&document.addEventListener("pointerup",A);return}if(t.type==="dragstart"){t.preventDefault();return}pieceElement.classList.add("dragging")}function ct(t){if(t.preventDefault(),!r.dragState.isDragging)return;const e=t.clientX,n=t.clientY;Y(e,n);const o=We(e,n);if(!o){oe(),r.dragState.lastTargetRow=void 0,r.dragState.lastTargetCol=void 0;return}const a=o.row-r.dragState.offsetY,i=o.col-r.dragState.offsetX,s=r.currentPieces[r.dragState.pieceIndex],c=H(s.currentShape,a,i);qe(s,a,i,c),r.dragState.lastTargetRow=a,r.dragState.lastTargetCol=i}function Ge(t){if(t.preventDefault(),!r.dragState.isDragging)return;const{pieceIndex:e,lastTargetRow:n,lastTargetCol:o}=r.dragState;if(n!==void 0&&o!==void 0){const a=r.currentPieces[e];H(a.currentShape,n,o)?rn(a,e,n,o):(he(),F())}else he(),F()}function ie(){r.dragState.isDragging&&F()}function ze(){r.dragState.isDragging&&F()}function Me(){ee&&(cancelAnimationFrame(ee),ee=0),document.removeEventListener("touchmove",an),document.removeEventListener("touchend",pe),document.removeEventListener("touchcancel",pe)}let lt=null,ee=0;function an(t){if(!r.dragState.isDragging)return;t.cancelable&&t.preventDefault();const e=Array.from(t.touches).find(a=>a.identifier===r.dragState.touchIdentifier);if(!e)return;const n=e.clientX,o=e.clientY;if(Y(n,o+r.dragState.touchOffsetY),!r.dragState.hasMoved){const a=n-r.dragState.startX,i=o-r.dragState.startY;(Math.abs(a)>10||Math.abs(i)>10)&&(r.dragState.hasMoved=!0)}lt=t,ee||(ee=requestAnimationFrame(()=>{const a=lt;ee=0,a&&Bo(a)}))}function xo(t){if(r.isPaused||r.isGameOver||r.specialModes.rotateMode||r.specialModes.flipMode||r.specialModes.hintMode)return;t.cancelable&&t.target.closest(".piece")&&t.preventDefault(),Me(),G(),O(30);const e=t.touches[0],n=t.target.closest(".piece");if(!n||n.classList.contains("empty"))return;const o=parseInt(n.dataset.pieceIndex),a=r.currentPieces[o],i=n.getBoundingClientRect(),s=e.clientX-i.left,c=e.clientY-i.top;let d={dist:1/0,row:0,col:0};n.querySelectorAll(".piece-block[data-shape-row]").forEach(u=>{const m=u.getBoundingClientRect(),g=m.left-i.left+m.width/2,S=m.top-i.top+m.height/2,E=Math.hypot(s-g,c-S);E<d.dist&&(d={dist:E,row:parseInt(u.dataset.shapeRow),col:parseInt(u.dataset.shapeCol)})});const l=-85;ne(),on(),Object.assign(r.dragState,{isDragging:!0,pieceIndex:o,pieceSourceElement:n,offsetX:d.col,offsetY:d.row,touchIdentifier:e.identifier,startX:e.clientX,startY:e.clientY,startTime:Date.now(),hasMoved:!1,touchOffsetY:l}),Ft(a),Y(e.clientX,e.clientY+l),n.classList.add("dragging"),document.addEventListener("touchmove",an,{passive:!1}),document.addEventListener("touchend",pe,{passive:!1}),document.addEventListener("touchcancel",pe,{passive:!1})}function Bo(t){if(!r.dragState.isDragging)return;t.cancelable&&t.preventDefault();const e=Array.from(t.touches).find(l=>l.identifier===r.dragState.touchIdentifier);if(!e)return;const n=e.clientX,o=e.clientY;r.dragState.clientX=n,r.dragState.clientY=o+r.dragState.touchOffsetY;const a=We(n,o+r.dragState.touchOffsetY);if(!a){oe(),r.dragState.lastTargetRow=void 0,r.dragState.lastTargetCol=void 0;return}const i=a.row-r.dragState.offsetY,s=a.col-r.dragState.offsetX;if(i===r.dragState.lastTargetRow&&s===r.dragState.lastTargetCol)return;const c=r.currentPieces[r.dragState.pieceIndex],d=H(c.currentShape,i,s);qe(c,i,s,d),r.dragState.lastTargetRow=i,r.dragState.lastTargetCol=s}function pe(t){if(!r.dragState.isDragging)return;Me();const e=Date.now()-(r.dragState.startTime||0);if(!r.dragState.hasMoved&&e<300){F();return}setTimeout(()=>{Ge(t)},50)}function rn(t,e,n,o){pn(e,n,o,t.currentShape.length),pt("placement-process"),window.clearHintHighlights&&window.clearHintHighlights(),console.time("placement:save-state"),$e(),console.timeEnd("placement:save-state"),r.lastPlacementCells=t.currentShape.map(([i,s])=>({r:n+i,c:o+s})),console.time("placement:place-piece"),kt(t,n,o),console.timeEnd("placement:place-piece"),Nn(),console.time("placement:replace-piece"),Mt(e),console.timeEnd("placement:replace-piece"),console.time("placement:detect-lines");const a=Pt(t.color);if(console.timeEnd("placement:detect-lines"),a){const i=a.clearedRows.length+a.clearedCols.length;hn(a.clearedRows.concat(a.clearedCols),i*10),Ve(a.pointsEarned,"line clear"),console.time("placement:animate-lines"),sn(a,()=>{console.timeEnd("placement:animate-lines"),console.time("placement:update-state"),I(),Be(),r.isGameOver&&(r.isPaused=!1,Ze(),Xe(r.score,e+1)),ge(),console.timeEnd("placement:update-state"),console.time("placement:finish-drag"),F(),console.timeEnd("placement:finish-drag"),Ae("placement-process")},t.color),Io(a.pointsEarned,a.comboCount)}else Ve(0,"placement only"),console.time("placement:update-state-no-clear"),I(),Be(),r.isGameOver&&(r.isPaused=!1,Ze(),Xe(r.score,e+1)),ge(),console.timeEnd("placement:update-state-no-clear"),console.time("placement:finish-drag-no-clear"),F(),console.timeEnd("placement:finish-drag-no-clear"),Ae("placement-process")}function he(){yn("Invalid placement attempt - piece cannot be placed there"),eo(Ln),O([20,10,20])}function F(){console.time("finishDrag:total"),console.time("finishDrag:hide-elements"),Qn(),oe(),console.timeEnd("finishDrag:hide-elements"),Me(),document.removeEventListener("mousemove",Le),document.removeEventListener("mouseup",A),window.removeEventListener("mouseup",A),document.removeEventListener("mouseleave",A),"onpointerup"in window&&document.removeEventListener("pointerup",A),r.dragState.pieceSourceElement&&r.dragState.pieceSourceElement.classList.remove("dragging"),console.time("finishDrag:reset-state"),ne(),console.timeEnd("finishDrag:reset-state"),console.time("finishDrag:update-grid"),U(),console.timeEnd("finishDrag:update-grid"),console.time("finishDrag:animate-placement"),Jn(r.lastPlacementCells),console.timeEnd("finishDrag:animate-placement"),console.time("finishDrag:update-pieces"),te(),N(),console.timeEnd("finishDrag:update-pieces"),console.time("finishDrag:update-ui"),Se(),ve(),ge(),jn(),console.timeEnd("finishDrag:update-ui"),console.timeEnd("finishDrag:total")}function sn(t,e,n=null){xt(t.totalLinesCleared);const o=p;document.querySelector(".game-area"),!n&&t.placedPieceColor&&(n=t.placedPieceColor);let a=n||t&&t.placedPieceColor||null;if(!a&&t&&Array.isArray(t.cellsToAnimate)&&t.cellsToAnimate.length){const i=t.cellsToAnimate.find(s=>s&&s.animationColor);i&&i.animationColor&&(a=i.animationColor)}So({ctx:null,rows:t.clearedRows||[],cols:t.clearedCols||[],boardSize:o,placedPieceColor:a,onClearRow:i=>{if(r.grid[i]=Array(o).fill(0),U(),r.dragState.isDragging){const{clientX:s,clientY:c}=r.dragState;s!==void 0&&c!==void 0&&Y(s,c)}},onClearCol:i=>{for(let s=0;s<h;s++)r.grid[s][i]=0;if(U(),r.dragState.isDragging){const{clientX:s,clientY:c}=r.dragState;s!==void 0&&c!==void 0&&Y(s,c)}},onDone:()=>{typeof e=="function"&&e(),t.comboCount>1&&Kn(t.comboCount)},syncStart:!0})}function Io(t,e){(localStorage.getItem("selectedGameMode")||"collection")==="collection"&&K.checkForUnlocks(r.score),Math.floor(r.score/1e3)>Math.floor((r.score-t)/1e3)&&r.rotateTokens++,Math.floor(r.score/2e3)>Math.floor((r.score-t)/2e3)&&r.undoTokens++,e>=4&&r.clearLineTokens++,Math.floor(r.score/3e3)>Math.floor((r.score-t)/3e3)&&r.hintTokens++}function I(){const t=document.getElementById("rotateBtn"),e=document.getElementById("undoBtn"),n=document.getElementById("clearLineBtn"),o=document.getElementById("flipBtn");document.getElementById("fabRotate"),document.getElementById("fabUndo"),document.getElementById("fabClearLine"),document.getElementById("fabFlip"),document.getElementById("fabHint"),t&&(t.disabled=r.rotateTokens<=0,t.classList.toggle("active-mode",r.specialModes.rotateMode)),e&&(e.disabled=r.undoTokens<=0),n&&(n.disabled=r.clearLineTokens<=0,n.classList.toggle("active-mode",r.specialModes.clearLineMode)),o&&(o.disabled=r.flipTokens<=0,o.classList.toggle("active-mode",r.specialModes.flipMode));const a=document.getElementById("rotateCount"),i=document.getElementById("undoCount"),s=document.getElementById("clearLineCount"),c=document.getElementById("flipCount");a&&(a.textContent=r.rotateTokens),i&&(i.textContent=r.undoTokens),s&&(s.textContent=r.clearLineTokens),c&&(c.textContent=r.flipTokens)}function Ro(){if(it)return;window.initializeGame=Ee,window.attachPieceEventListeners=N;function t(g){r.rotateTokens>0&&(r.specialModes.rotateMode?(r.specialModes.rotateMode=!1,r.specialModes.isWaitingForRotate=!1,w("rotate_cancel",null,1500)):(r.specialModes.clearLineMode=!1,r.specialModes.hintMode=!1,r.specialModes.flipMode=!1,r.specialModes.rotateMode=!0,r.specialModes.isWaitingForRotate=!0,w("rotate",null,2e3)),I(),N())}function e(g){if(r.undoTokens>0){const S=(g==null?void 0:g.currentTarget)||document.getElementById("undoBtn");S&&(S.classList.add("active-mode"),setTimeout(()=>S.classList.remove("active-mode"),300)),r.undoTokens--,wt()?(U(),te(),Se(),I(),N(),w("undo","Last move undone!",2e3)):(r.undoTokens++,I(),w("error","No moves to undo!",2e3))}}function n(){if(r.clearLineTokens>0){const g=!r.specialModes.clearLineMode;r.specialModes.rotateMode=!1,r.specialModes.flipMode=!1,r.specialModes.hintMode=!1,r.specialModes.clearLineMode=g,r.specialModes.isWaitingForRotate=!1,r.specialModes.isWaitingForFlip=!1,r.specialModes.isWaitingForSelection=g,g?(to(),w("clearLine")):(ce(),w("clearLine_cancel","Clear line mode cancelled.",2e3)),I(),N()}}function o(g){r.flipTokens>0&&(r.specialModes.flipMode?(r.specialModes.flipMode=!1,r.specialModes.isWaitingForFlip=!1,w("flip_cancel","Flip mode cancelled",1500)):(r.specialModes.rotateMode=!1,r.specialModes.clearLineMode=!1,r.specialModes.flipMode=!0,r.specialModes.isWaitingForFlip=!0,w("flip","Click a piece to flip it",2e3)),I(),N())}const a=document.getElementById("rotateBtn");a&&(a.addEventListener("click",t),a.addEventListener("touchend",g=>{g.preventDefault(),t()}));const i=document.getElementById("fabRotate");i&&(i.addEventListener("click",t),i.addEventListener("touchend",g=>{g.preventDefault(),t()}));const s=document.getElementById("undoBtn");s&&(s.addEventListener("click",e),s.addEventListener("touchend",g=>{g.preventDefault(),e(g)}));const c=document.getElementById("fabUndo");c&&(c.addEventListener("click",e),c.addEventListener("touchend",g=>{g.preventDefault(),e(g)}));const d=document.getElementById("clearLineBtn");d&&(d.addEventListener("click",n),d.addEventListener("touchend",g=>{g.preventDefault(),n()}));const l=document.getElementById("fabClearLine");l&&(l.addEventListener("click",n),l.addEventListener("touchend",g=>{g.preventDefault(),n()}));const u=document.getElementById("flipBtn");u&&(u.addEventListener("click",o),u.addEventListener("touchend",g=>{g.preventDefault(),o()}));const m=document.getElementById("fabFlip");m&&(m.addEventListener("click",o),m.addEventListener("touchend",g=>{g.preventDefault(),o()})),it=!0}en(Ro);function dt(t){const e=t.target.closest(".piece");if(!e||e.classList.contains("empty"))return;const n={...t,target:e};nn(n)}function ut(t){if(!(r.specialModes.rotateMode||r.specialModes.flipMode||r.specialModes.clearLineMode||r.specialModes.hintMode))return;t.preventDefault();const n=t.target.closest(".piece");if(!n||n.classList.contains("empty"))return;const o={...t,target:n};nn(o)}function N(){const t=document.querySelector(".pieces-container");t&&(t.removeEventListener("click",dt),t.addEventListener("click",dt),t.removeEventListener("touchend",ut),t.addEventListener("touchend",ut,{passive:!1})),document.querySelectorAll(".piece:not(.empty)").forEach((n,o)=>{const a=r.specialModes.rotateMode||r.specialModes.flipMode||r.specialModes.clearLineMode||r.specialModes.hintMode;n.setAttribute("draggable","false"),n.removeEventListener("dragstart",fe),n.removeEventListener("mousedown",fe),n.removeEventListener("touchstart",fe),a||(n.addEventListener("mousedown",fe),n.addEventListener("touchstart",xo,{passive:!1}))}),ye=!0}function Do(){if(rt)return;Bt(),It(),(localStorage.getItem("blokusTheme")||"default")==="magic-universe"&&io(),tn();const e=f,n=document.getElementById("classicMode"),o=document.getElementById("collectionMode"),a=document.querySelector(".feedback");if(n&&o){let s=function(c){at=c,localStorage.setItem("selectedGameMode",at),a&&(a.style.display="none",a.textContent=""),document.querySelectorAll(".card.selectable").forEach(d=>{d.classList.remove("selected")}),c==="classic"?n.classList.add("selected"):c==="collection"&&o.classList.add("selected"),e.startButton&&(e.startButton.classList.remove("hidden"),e.startButton.disabled=!1,e.startButton.innerHTML=`<i class="fas fa-play-circle"></i> Start ${c==="classic"?"Classic":"Collection"}`,e.startButton.style.transform="scale(1.05)",setTimeout(()=>{e.startButton.style.transform="scale(1)"},300))};const i=localStorage.getItem("selectedGameMode");i&&s(i)}e.gameOverRestartButton&&e.gameOverRestartButton.addEventListener("click",()=>{const i=document.querySelector(".special-actions");i&&i.classList.add("hidden"),e.landingPage.classList.remove("hidden"),e.gameContainer.classList.add("hidden"),Ee()}),document.body.addEventListener("click",G,{once:!0}),document.body.addEventListener("touchstart",G,{once:!0}),rt=!0}en(Do);document.addEventListener("touchmove",function(t){r.dragState&&r.dragState.isDragging&&t.scale!==1&&t.preventDefault()},{passive:!1});function Oo(){f.gameGrid&&(f.gameGrid.removeEventListener("dragover",ct),f.gameGrid.removeEventListener("drop",Ge),f.gameGrid.removeEventListener("dragend",ie),f.gameGrid.addEventListener("dragover",ct),f.gameGrid.addEventListener("drop",Ge),f.gameGrid.addEventListener("dragend",ie)),document.removeEventListener("dragend",ie),document.addEventListener("dragend",ie),document.removeEventListener("mouseup",ze),document.addEventListener("mouseup",ze),document.querySelectorAll(".grid-cell").forEach(e=>{e.removeEventListener("click",ft),e.addEventListener("click",ft)})}function ft(t){if(!r.specialModes.clearLineMode||!r.specialModes.isWaitingForSelection)return;let e=t.target;if(e.classList.contains("grid-cell")||(e=e.closest(".grid-cell")),!e||!e.classList.contains("grid-cell"))return;const n=parseInt(e.dataset.row),o=parseInt(e.dataset.col);$e(),r.clearLineTokens--;const a=[],i=[],s=[];let c=!1;for(let l=0;l<r.grid[0].length;l++)if(r.grid[n][l]!==0){c=!0;break}let d=!1;for(let l=0;l<r.grid.length;l++)if(r.grid[l][o]!==0){d=!0;break}if(!c&&!d){r.clearLineTokens++,I(),w("clearLine_cancel","Nuk ka linja tÃ« mbushura nÃ« kÃ«tÃ« qelizÃ«.",2e3),r.specialModes.clearLineMode=!1,r.specialModes.isWaitingForSelection=!1,ce();return}if(c){i.push(n);for(let l=0;l<r.grid[0].length;l++)r.grid[n][l]!==0&&a.push({row:n,col:l,animationColor:"rgba(198,140,83,1)"})}if(d){s.push(o);for(let l=0;l<r.grid.length;l++)r.grid[l][o]!==0&&(a.some(u=>u.row===l&&u.col===o)||a.push({row:l,col:o,animationColor:"rgba(198,140,83,1)"}))}if(I(),i.length>0||s.length>0){const l={cellsToAnimate:a,pointsEarned:0,comboCount:1,totalLinesCleared:i.length+s.length,clearedRows:i,clearedCols:s,_postAnimation:()=>{U(),I()}};sn(l)}w("clearLine_success",`Row ${n+1} and Column ${o+1} cleared!`,2e3),xt(1),r.specialModes.clearLineMode=!1,r.specialModes.isWaitingForSelection=!1,I(),ce()}function w(t,e,n=null){let o=document.getElementById("specialModeMessage");o||(o=document.createElement("div"),o.id="specialModeMessage",o.className="special-mode-message",document.body.appendChild(o)),o.hideTimeout&&(clearTimeout(o.hideTimeout),o.hideTimeout=null);const i=e||{rotate:"ROTATE MODE: Click any piece to rotate it",rotate_cancel:"Rotate mode cancelled",clearLine:"CLEAR LINE MODE: Click any cell in a complete row/column to clear it",clearLine_success:"Line cleared successfully!",clearLine_cancel:"Clear line mode cancelled",undo:"Last move undone successfully!",swap:"All pieces swapped successfully!",error:"Action failed - please try again"}[t]||"Special action activated";o.textContent=i,o.className=`special-mode-message ${t}`,o.classList.remove("hidden"),n&&(o.hideTimeout=setTimeout(()=>{o.classList.add("hidden"),o.hideTimeout=null},n))}window.showSpecialModeMessage=w;function cn(){Me(),document.removeEventListener("dragend",ie),document.removeEventListener("mouseup",ze),document.removeEventListener("mousemove",Le),document.removeEventListener("mouseup",A),window.removeEventListener("mouseup",A),document.removeEventListener("mouseleave",A),"onpointerup"in window&&document.removeEventListener("pointerup",A),typeof Oe=="function"&&Oe(),typeof nt=="function"&&nt(),document.querySelectorAll(".floating-score").forEach(e=>{e.remove()});const t=document.getElementById("unlock-progress");t&&t.remove(),oe(),ce(),ye=!1,r.dragState&&ne()}window.addEventListener("beforeunload",cn);let ye=!1;document.addEventListener("lines:cleared",()=>Z(()=>Promise.resolve().then(()=>He),void 0).then(t=>t.hapticSuccess&&t.hapticSuccess()).catch(()=>{}));document.addEventListener("combo:achieved",t=>Z(()=>Promise.resolve().then(()=>He),void 0).then(e=>{var n;((n=t.detail)==null?void 0:n.lines)>=3&&e.hapticHeavy?e.hapticHeavy():e.hapticSuccess&&e.hapticSuccess()}).catch(()=>{}));document.addEventListener("game:over",()=>Z(()=>Promise.resolve().then(()=>He),void 0).then(t=>t.hapticHeavy&&t.hapticHeavy()).catch(()=>{}));window.addEventListener("DOMContentLoaded",()=>{if(window.innerWidth>=900){const t=document.querySelector(".game-container");t&&t.getBoundingClientRect()}});let mt=window.innerWidth<=768?"mobile":"desktop",gt;window.addEventListener("resize",()=>{clearTimeout(gt),gt=setTimeout(()=>{const t=window.innerWidth<=768?"mobile":"desktop";if(t!==mt){const e=document.querySelector('link[href*="mobile.css"]'),n=document.querySelector('link[href*="desktop.css"]');t==="mobile"&&e?(e.media="all",setTimeout(()=>e.media="(max-width:768px)",0)):t==="desktop"&&n&&(n.media="all",setTimeout(()=>n.media="(min-width:769px)",0)),requestAnimationFrame(()=>{const o=document.querySelector(".game-container"),a=document.querySelector(".game-area"),i=document.getElementById("gameGrid");[o,a,i].forEach(s=>{s&&s.offsetHeight})}),mt=t}},300)});const Fo=Object.freeze(Object.defineProperty({__proto__:null,initMain:ko,updateLandingPageStats:tn},Symbol.toStringTag,{value:"Module"}));export{ko as initMain,tn as updateLandingPageStats};
//# sourceMappingURL=main-B1VZLU5S.js.map
